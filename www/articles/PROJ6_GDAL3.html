<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Migration to PROJ6/GDAL3 • rgdal</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Migration to PROJ6/GDAL3">
<meta property="og:description" content="rgdal">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rgdal</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5-10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CRS_projections_transformations.html">Why have CRS, projections and transformations changed?</a>
    </li>
    <li>
      <a href="../articles/PROJ6_GDAL3.html">Migration to PROJ6/GDAL3</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Migration to PROJ6/GDAL3</h1>
                        <h4 class="author">Roger Bivand</h4>
            
      
      
      <div class="hidden name"><code>PROJ6_GDAL3.Rmd</code></div>

    </div>

    
    
<div id="status-22-april-2020" class="section level1">
<h1 class="hasAnchor">
<a href="#status-22-april-2020" class="anchor"></a>Status 22 April 2020</h1>
<p><a href="https://www.r-spatial.org/r/2020/03/17/wkt.html">R spatial follows GDAL and PROJ development</a> describes the main points of the status now. <strong>sp</strong> uses WKT2 CRS with PROJ6+/GDAL3+. <strong>sp</strong> and <strong>rgdal</strong> read, write, and project and transform objects using PROJ strings before PROJ6/GDAL3 and when <strong>raster</strong> calls <code><a href="../reference/wrappers.html">rgdal::rawTransform()</a></code> with PROJ6+/GDAL3+. <strong>sp</strong> and <strong>rgdal</strong> read, write, and project and transform objects using WKT2_2019 strings from PROJ6/GDAL3. The mechanism used is described in the R-spatial blog.</p>
<p>This rolling RFC (not many comments) depicts the state of play from October 2019 to April 2020, involving a lot of reverse dependency testing of almost 1000 CRAN packages. When the development versions of <strong>sp</strong> (&gt;= 1.4-2) and <strong>rgdal</strong> (&gt;= 1.5-8) are submitted to CRAN, a fair number of reverse dependencies will be broken (as with recent <strong>sf</strong> releases). Some maintainers sensibly find that fixing the PROJ6/GDAL3 transition is sufficiently invasive to make it sensible to re-base to <strong>sf</strong> from <strong>sp</strong>. Others are regretably unresponsive so far, many find it hard to check on PROJ6+/GDAL3.</p>
<p>For further links (in addition to the blog post), see (<a href="https://github.com/r-spatial/discuss/issues/28" class="uri">https://github.com/r-spatial/discuss/issues/28</a>), and <strong>sf</strong> github issues: <a href="https://github.com/r-spatial/sf/issues/1146" class="uri">https://github.com/r-spatial/sf/issues/1146</a>, <a href="https://github.com/r-spatial/sf/issues/1187" class="uri">https://github.com/r-spatial/sf/issues/1187</a>, <a href="https://github.com/r-spatial/sf/issues/1231" class="uri">https://github.com/r-spatial/sf/issues/1231</a>, <a href="https://github.com/r-spatial/sf/issues/1328" class="uri">https://github.com/r-spatial/sf/issues/1328</a> and many others.</p>
<p>We’ve established that we should have preferred WKT over PROJ strings starting eight years ago: <a href="https://lists.osgeo.org/pipermail/gdal-dev/2012-November/034558.html" class="uri">https://lists.osgeo.org/pipermail/gdal-dev/2012-November/034558.html</a> (read the last paragraph), and possibly even earlier.</p>
</div>
<div id="migration-to-proj6gdal3" class="section level1">
<h1 class="hasAnchor">
<a href="#migration-to-proj6gdal3" class="anchor"></a>Migration to PROJ6/GDAL3</h1>
<div id="proj" class="section level2">
<h2 class="hasAnchor">
<a href="#proj" class="anchor"></a>PROJ</h2>
<p>Because so much open source (and other) software uses the PROJ library and framework, many are affected when PROJ upgrades. Until very recently, PROJ has been seen as very reliable, and the changes taking place now are intended to confirm and reinforce this reliability. Before PROJ 5 (PROJ 6 is out now, PROJ 7 is coming early in 2020), the <code>+datum=</code> tag was used, perhaps with <code>+towgs84=</code> with three or seven coefficients, and possibly <code>+nadgrids=</code> where datum transformation grids were available. However, transformations from one projection to another first inversed to longitude-latitude in WGS84, then projected on to the target projection.</p>
<p>‘Fast-forward 35 years and PROJ.4 is everywhere: It provides coordinate handling for almost every geospatial program, open or closed source. Today, we see a drastical increase in the need for high accuracy GNSS coordinate handling, especially in the agricultural and construction engineering sectors. This need for geodetic-accuracy transformations is not satisfied by “classic PROJ.4”. But with the ubiquity of PROJ.4, we can provide these transformations “everywhere”, just by implementing them as part of PROJ.4’ <span class="citation">(Evers and Knudsen <a href="#ref-evers+knudsen17" role="doc-biblioref">2017</a>)</span>.</p>
<p>Following the introduction of geodetic modules and pipelines in PROJ 5 <span class="citation">(Knudsen and Evers <a href="#ref-knudsen+evers17" role="doc-biblioref">2017</a>; Evers and Knudsen <a href="#ref-evers+knudsen17" role="doc-biblioref">2017</a>)</span>, PROJ 6 moves further. Changes in the legacy PROJ representation and WGS84 transformation hub have been coordinated through the <a href="https://gdalbarn.com/">GDAL barn raising</a> initiative. Crucially WGS84 often ceases to be the pivot for moving between datums. A new OGC WKT is coming, and an SQLite EPSG file database has replaced CSV files. SRS will begin to support 3D by default, adding time too as SRS change. See also <a href="https://proj.org/development/migration.html">PROJ migration notes</a>.</p>
<p>There are very useful postings on the PROJ mailing list from Martin Desruisseaux, first <a href="https://lists.osgeo.org/pipermail/proj/2019-July/008748.html">proposing clarifications</a> and a <a href="https://lists.osgeo.org/pipermail/proj/2019-August/008750.html">follow-up</a> including a summary:</p>
<blockquote>
<ul>
<li>“Early binding” ≈ hub transformation technique.</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>“Late binding” ≈ hub transformation technique NOT used, replaced by a more complex technique consisting in searching parameters in the EPSG database after the transformation context (source, target, epoch, area of interest) is known.</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>The problem of hub transformation technique is independent of WGS84. It is caused by the fact that transformations to/from the hub are approximate. Any other hub we could invent in replacement of WGS84 will have the same problem, unless we can invent a hub for which transformations are exact (I think that if such hub existed, we would have already heard about it).</li>
</ul>
</blockquote>
<blockquote>
<p>The solution proposed by ISO 19111 (in my understanding) is:</p>
</blockquote>
<blockquote>
<ul>
<li>Forget about hub (WGS84 or other), unless the simplicity of early-binding is considered more important than accuracy.</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>Associating a CRS to a coordinate set (geometry or raster) is no longer sufficient. A {CRS, epoch} tuple must be associated. ISO 19111 calls this tuple “Coordinate metadata”. From a programmatic API point of view, this means that getCoordinateReferenceSystem() method in Geometry objects (for instance) needs to be replaced by a getCoordinateMetadata() method.</li>
</ul>
</blockquote>
<p>For users of North American spatial data, this <a href="https://www.esri.com/about/newsroom/arcuser/moving-from-static-spatial-reference-systems-in-2022/">ESRI news item</a> gives a broad-brush picture of some of the motivations and oncoming changes.</p>
</div>
<div id="impacts-of-gdal-barnraising-on-sp-workflows" class="section level2">
<h2 class="hasAnchor">
<a href="#impacts-of-gdal-barnraising-on-sp-workflows" class="anchor"></a>Impacts of GDAL barnraising on <strong>sp</strong> workflows</h2>
<p>The following examples will contrast the behaviour of PROJ4/GDAL2 (similar to PROJ5/GDAL2, and PROJ4/GDAL1) and PROJ6+/GDAL3+. In particular, the behaviour of the <code>exportToProj4()</code> function in GDAL’s <code>OGRSpatialReference</code> class has changed:</p>
<blockquote>
<p>Warning Use of this function is discouraged. Its behaviour in GDAL &gt;= 3 / PROJ &gt;= 6 is significantly different from earlier versions. In particular +datum will only encode WGS84, NAD27 and NAD83, and +towgs84/+nadgrids terms will be missing most of the time. PROJ strings to encode CRS should be considered as a a legacy solution. Using a AUTHORITY:CODE or WKT representation is the recommended way.</p>
</blockquote>
<p>(<a href="https://gdal.org/doxygen/classOGRSpatialReference.html#a271b3de4caf844135b0c61e634860f2b" class="uri">https://gdal.org/doxygen/classOGRSpatialReference.html#a271b3de4caf844135b0c61e634860f2b</a>); see also (<a href="https://github.com/r-spatial/sf/issues/1187" class="uri">https://github.com/r-spatial/sf/issues/1187</a>) and links therein to (<a href="https://github.com/r-spatial/discuss/issues/28" class="uri">https://github.com/r-spatial/discuss/issues/28</a>) and (<a href="https://github.com/r-spatial/sf/issues/1146" class="uri">https://github.com/r-spatial/sf/issues/1146</a>).</p>
<p>This function is used for both raster and vector data read through GDAL to provide the PROJ 4 string used to specify the coordinate reference system of <strong>sp</strong> <code>"Spatial"</code> objects using the <code>"CRS"</code> (S4, new style) class. Such classes cannot be modified without making it impossible for users to load serialised objects, such as <strong>sp</strong> RDS objects from GADM <a href="https://gadm.org/download_country_v3.html">for example for Norway</a>.</p>
<p>My fork of <strong>sp</strong> (<a href="https://github.com/rsbivand/sp" class="uri">https://github.com/rsbivand/sp</a>) is currently at 1.3-3 or higher, and contains extra code conditionally using the development version of <strong>rgdal</strong> on the R-Forge repository at 1.5-1 or higher. The commented out blocks marked PROJ4/GDAL2 were generated on a Windows platform with <strong>sp</strong> 1.3-2 and <strong>rgdal</strong> 1.4-7, using PROJ4/GDAL2. The other commented out blocks were <strong>sp</strong> fork and <strong>rgdal</strong> development version, revision 886. The uncommented output is what the package build platform put there.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sp</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span>(<span class="st">"sp"</span>)</pre></body></html></div>
<pre><code>## [1] '1.4.2'</code></pre>
<div class="sourceCode" id="cb3"><html><body><pre class="r">## [1] '1.3.3'</pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r">## PROJ4/GDAL2 [1] '1.3.2'</pre></body></html></div>
<p>The <code>"CRS"</code> class definition is unchanged going forward to maintain backward compatibility.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu">getClass</span>(<span class="st">"CRS"</span>)</pre></body></html></div>
<pre><code>## Class "CRS" [package "sp"]
## 
## Slots:
##                 
## Name:   projargs
## Class: character</code></pre>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="kw pkg">rgdal</span><span class="kw ns">::</span><span class="fu"><a href="../reference/GDALDriver-class.html">rgdal_extSoftVersion</a></span>()</pre></body></html></div>
<pre><code>##           GDAL GDAL_with_GEOS           PROJ             sp 
##        "3.1.0"         "TRUE"        "7.0.1"        "1.4-2"</code></pre>
<div class="sourceCode" id="cb9"><html><body><pre class="r">##           GDAL GDAL_with_GEOS           PROJ             sp 
##        "3.0.2"         "TRUE"        "6.2.1"        "1.3-3"</pre></body></html></div>
<div class="sourceCode" id="cb10"><html><body><pre class="r">## PROJ4/GDAL2           GDAL GDAL_with_GEOS         PROJ.4             sp 
## PROJ4/GDAL2        "2.2.3"         "TRUE"        "4.9.3"        "1.3-1"</pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span>(<span class="st">"rgdal"</span>)</pre></body></html></div>
<pre><code>## [1] '1.5.10'</code></pre>
<div class="sourceCode" id="cb13"><html><body><pre class="r">## [1] '1.5.1'</pre></body></html></div>
<div class="sourceCode" id="cb14"><html><body><pre class="r">## PROJ4/GDAL2 [1] '1.4.7'</pre></body></html></div>
<p>The changes introduced affect <code><a href="../reference/CRS-class.html">CRS()</a></code> when <strong>rgdal</strong> is available; if <strong>rgdal</strong> is not available, the <code>"CRS"</code> object just contains a lightly checked PROJ-style string. Because some terms are deprecated or defunct from PROJ6/GDAL3, we need to be careful. GDAL’s <code>exportToProj4()</code> uses the PROJ <code>proj_as_proj_string()</code> function in its new API to return the PROJ string. Terms which are deprecated or defunct may be omitted. In the PROJ6+/GDAL3+ case, <code><a href="../reference/CRS-class.html">CRS()</a></code> calls <code><a href="../reference/CRS-class.html">rgdal::checkCRSArgs_ng()</a></code>, a new generation function replacing the legacy <code><a href="../reference/CRS-class.html">rgdal::checkCRSArgs()</a></code> function.</p>
<p>It passes on the input PROJ-style string to <code><a href="../reference/showWKT.html">rgdal::showSRID()</a></code>, which is a many-to-many converter. It can take PROJ-style strings, WKT strings, urn-style strings and EPSG-style strings, and converts to WKT (many types) and PROJ. The PROJ-to-PROJ conversion is equivalent to PROJ4/GDAL2 behaviour, using <code>importFromProj4()</code> and friends to instantiate an SRS object in GDAL, and <code>exportToProj4()</code> and <code>exportToWkt()</code> to emit strings. If the output string appears to be missing a specification term implied by the input, a warning is given; the warnings are at present overly cautious.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r">(<span class="no">crs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+proj=longlat +ellps=WGS84"</span>))</pre></body></html></div>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
## datum Unknown based on WGS84 ellipsoid in CRS definition</code></pre>
<pre><code>## CRS arguments: +proj=longlat +ellps=WGS84 +no_defs</code></pre>
<div class="sourceCode" id="cb18"><html><body><pre class="r">## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"):
## Discarded datum Unknown_based_on_WGS84_ellipsoid in CRS definition

## CRS arguments: +proj=longlat +ellps=WGS84 +no_defs</pre></body></html></div>
<p>In <code><a href="../reference/CRS-class.html">rgdal::checkCRSArgs_ng()</a></code>, <code><a href="../reference/showWKT.html">rgdal::showSRID()</a></code> may be called several times. If the passed <code>"CRS"</code> object only has a non-NA PROJ-style string, this is used to populate the SRS object, as in this case. In addition to emitting a checked PROJ string, a WKT2 string is also returned (WKT2_2018), and this string is assigned as a <code><a href="https://rdrr.io/r/base/comment.html">comment()</a></code> to the <code>"CRS"</code> object. This representation is far more robust than the PROJ-style string, giving authorities and table look-up ID values. (<em>WKT comment strings are reported here split across lines, because some find right-scrolling unpretty; the real format is as a character string on one line only</em>).</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">","</span>, <span class="st">", "</span>, (<span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="no">crs</span>)))), <span class="kw">sep</span><span class="kw">=</span><span class="st">"\n"</span>)</pre></body></html></div>
<pre><code>## GEOGCRS["unknown", DATUM["Unknown based on WGS84 ellipsoid",
## ELLIPSOID["WGS 84", 6378137, 298.257223563, LENGTHUNIT["metre", 1],
## ID["EPSG", 7030]]], PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
## 0.0174532925199433], ID["EPSG", 8901]], CS[ellipsoidal, 2],
## AXIS["longitude", east, ORDER[1], ANGLEUNIT["degree",
## 0.0174532925199433, ID["EPSG", 9122]]], AXIS["latitude", north,
## ORDER[2], ANGLEUNIT["degree", 0.0174532925199433, ID["EPSG", 9122]]]]</code></pre>
<div class="sourceCode" id="cb21"><html><body><pre class="r">## [1] "GEOGCRS[\"unknown\", DATUM[\"Unknown based on WGS84 ellipsoid\",
## ELLIPSOID[\"WGS 84\", 6378137, 298.257223563, LENGTHUNIT[\"metre\", 1],
## ID[\"EPSG\", 7030]]], PRIMEM[\"Greenwich\", 0, ANGLEUNIT[\"degree\",
## 0.0174532925199433], ID[\"EPSG\", 8901]], CS[ellipsoidal, 2], AXIS[\"longitude\",
## east, ORDER[1], ANGLEUNIT[\"degree\", 0.0174532925199433, ID[\"EPSG\", 9122]]],
## AXIS[\"latitude\", north, ORDER[2], ANGLEUNIT[\"degree\", 0.0174532925199433,
## ID[\"EPSG\", 9122]]]]"</pre></body></html></div>
<p>For the PROJ4/GDAL2 (and similar) cases, if <strong>rgdal</strong> is available, <code><a href="../reference/CRS-class.html">CRS()</a></code> calls <code><a href="../reference/CRS-class.html">rgdal::checkCRSArgs()</a></code>, calling <code><a href="../reference/CRS-class.html">RGDAL_checkCRSArgs()</a></code>, a compiled function, which calls <code>pj_init_plus()</code> in PROJ to check the validity of the string and possibly expand terms. If this succeeds, <code>pj_get_def()</code> is used to return the PROJ string. Both of these functions are part of the deprecated PROJ API that is still accessible in PROJ 6, but will soon be made defunct.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r">## PROJ4/GDAL2 CRS arguments: +proj=longlat +ellps=WGS84</pre></body></html></div>
<p>A number of further examples will be given here, including the case of one of three <code>+datum=</code> values that are still acknowledged in GDAL3/PROJ6: <code>WGS84</code>, <code>NAD27</code> and <code>NAD83</code>.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r">(<span class="no">crs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+proj=longlat +datum=WGS84"</span>))</pre></body></html></div>
<pre><code>## CRS arguments: +proj=longlat +datum=WGS84 +no_defs</code></pre>
<div class="sourceCode" id="cb25"><html><body><pre class="r">## CRS arguments: +proj=longlat +datum=WGS84 +no_defs</pre></body></html></div>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">","</span>, <span class="st">", "</span>, (<span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="no">crs</span>)))), <span class="kw">sep</span><span class="kw">=</span><span class="st">"\n"</span>)</pre></body></html></div>
<pre><code>## GEOGCRS["unknown", DATUM["World Geodetic System 1984", ELLIPSOID["WGS
## 84", 6378137, 298.257223563, LENGTHUNIT["metre", 1]], ID["EPSG",
## 6326]], PRIMEM["Greenwich", 0, ANGLEUNIT["degree", 0.0174532925199433],
## ID["EPSG", 8901]], CS[ellipsoidal, 2], AXIS["longitude", east,
## ORDER[1], ANGLEUNIT["degree", 0.0174532925199433, ID["EPSG", 9122]]],
## AXIS["latitude", north, ORDER[2], ANGLEUNIT["degree",
## 0.0174532925199433, ID["EPSG", 9122]]]]</code></pre>
<div class="sourceCode" id="cb28"><html><body><pre class="r">## [1] "GEOGCRS[\"unknown\", DATUM[\"World Geodetic System 1984\",
## ELLIPSOID[\"WGS 84\", 6378137, 298.257223563, LENGTHUNIT[\"metre\", 1]], 
## ID[\"EPSG\", 6326]], PRIMEM[\"Greenwich\", 0, ANGLEUNIT[\"degree\",
## 0.0174532925199433], ID[\"EPSG\", 8901]], CS[ellipsoidal, 2], AXIS[\"longitude\",
## east, ORDER[1], ANGLEUNIT[\"degree\", 0.0174532925199433, ID[\"EPSG\", 9122]]],
## AXIS[\"latitude\", north, ORDER[2], ANGLEUNIT[\"degree\", 0.0174532925199433,
## ID[\"EPSG\", 9122]]]]"</pre></body></html></div>
<div class="sourceCode" id="cb29"><html><body><pre class="r">## PROJ4/GDAL2 CRS arguments:
## PROJ4/GDAL2  +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0</pre></body></html></div>
<p>We know that <code>+datum</code>, <code>+towgs84</code>, <code>+nadgrids</code> and <code>+init</code> are fragile, so we’ll try one:</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r">(<span class="no">crs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+proj=longlat +towgs84=0,0,0"</span>))</pre></body></html></div>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded datum WGS_1984 in CRS definition,
##  but +towgs84= values preserved</code></pre>
<pre><code>## CRS arguments:
##  +proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs</code></pre>
<div class="sourceCode" id="cb33"><html><body><pre class="r">## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded datum WGS_1984 in CRS definition,
##  but +towgs84= values preserved

## CRS arguments:
##  +proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs</pre></body></html></div>
<p>The comment here includes the <code>+towgs84</code> parameters (three of them), while the PROJ string gives seven.</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">","</span>, <span class="st">", "</span>, (<span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="no">crs</span>)))), <span class="kw">sep</span><span class="kw">=</span><span class="st">"\n"</span>)</pre></body></html></div>
<pre><code>## BOUNDCRS[ SOURCECRS[ GEOGCRS["unknown", DATUM["World Geodetic System
## 1984", ELLIPSOID["WGS 84", 6378137, 298.257223563, LENGTHUNIT["metre",
## 1]], ID["EPSG", 6326]], PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
## 0.0174532925199433], ID["EPSG", 8901]], CS[ellipsoidal, 2],
## AXIS["longitude", east, ORDER[1], ANGLEUNIT["degree",
## 0.0174532925199433, ID["EPSG", 9122]]], AXIS["latitude", north,
## ORDER[2], ANGLEUNIT["degree", 0.0174532925199433, ID["EPSG", 9122]]]]],
## TARGETCRS[ GEOGCRS["WGS 84", DATUM["World Geodetic System 1984",
## ELLIPSOID["WGS 84", 6378137, 298.257223563, LENGTHUNIT["metre", 1]]],
## PRIMEM["Greenwich", 0, ANGLEUNIT["degree", 0.0174532925199433]],
## CS[ellipsoidal, 2], AXIS["latitude", north, ORDER[1],
## ANGLEUNIT["degree", 0.0174532925199433]], AXIS["longitude", east,
## ORDER[2], ANGLEUNIT["degree", 0.0174532925199433]], ID["EPSG", 4326]]],
## ABRIDGEDTRANSFORMATION["Transformation from unknown to WGS84",
## METHOD["Geocentric translations (geog2D domain)", ID["EPSG", 9603]],
## PARAMETER["X-axis translation", 0, ID["EPSG", 8605]], PARAMETER["Y-axis
## translation", 0, ID["EPSG", 8606]], PARAMETER["Z-axis translation", 0,
## ID["EPSG", 8607]]]]</code></pre>
<div class="sourceCode" id="cb36"><html><body><pre class="r">## [1] "BOUNDCRS[SOURCECRS[GEOGCRS[\"unknown\", DATUM[\"World Geodetic System 1984\",
## ELLIPSOID[\"WGS 84\", 6378137, 298.257223563, LENGTHUNIT[\"metre\", 1]], ID[\"EPSG\",
## 6326]], PRIMEM[\"Greenwich\", 0, ANGLEUNIT[\"degree\", 0.0174532925199433],
## ID[\"EPSG\", 8901]], CS[ellipsoidal, 2], AXIS[\"longitude\", east, ORDER[1],
## ANGLEUNIT[\"degree\", 0.0174532925199433, ID[\"EPSG\", 9122]]], AXIS[\"latitude\",
## north, ORDER[2], ANGLEUNIT[\"degree\", 0.0174532925199433, ID[\"EPSG\", 9122]]]]],
## TARGETCRS[GEOGCRS[\"WGS 84\", DATUM[\"World Geodetic System 1984\", ELLIPSOID[\"WGS
## 84\", 6378137, 298.257223563, LENGTHUNIT[\"metre\", 1]]], PRIMEM[\"Greenwich\", 0,
## ANGLEUNIT[\"degree\", 0.0174532925199433]], CS[ellipsoidal, 2], AXIS[\"latitude\",
## north, ORDER[1], ANGLEUNIT[\"degree\", 0.0174532925199433]], AXIS[\"longitude\", east,
## ORDER[2], ANGLEUNIT[\"degree\", 0.0174532925199433]], ID[\"EPSG\", 4326]]],
## ABRIDGEDTRANSFORMATION[\"Transformation from unknown to WGS84\", METHOD[\"Geocentric
## translations (geog2D domain)\", ID[\"EPSG\", 9603]], PARAMETER[\"X-axis translation\",
## 0, ID[\"EPSG\", 8605]], PARAMETER[\"Y-axis translation\", 0, ID[\"EPSG\", 8606]],
## PARAMETER[\"Z-axis translation\", 0, ID[\"EPSG\", 8607]]]]"</pre></body></html></div>
<div class="sourceCode" id="cb37"><html><body><pre class="r">## PROJ4/GDAL2 CRS arguments:
## PROJ4/GDAL2  +proj=longlat +towgs84=0,0,0 +ellps=WGS84</pre></body></html></div>
<p>The <code>+init</code> value is still accepted, but not repeated in the output:</p>
<div class="sourceCode" id="cb38"><html><body><pre class="r">(<span class="no">crs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+init=epsg:4326"</span>))</pre></body></html></div>
<pre><code>## CRS arguments: +proj=longlat +datum=WGS84 +no_defs</code></pre>
<div class="sourceCode" id="cb40"><html><body><pre class="r">## CRS arguments: +proj=longlat +datum=WGS84 +no_defs</pre></body></html></div>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">","</span>, <span class="st">", "</span>, (<span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="no">crs</span>)))), <span class="kw">sep</span><span class="kw">=</span><span class="st">"\n"</span>)</pre></body></html></div>
<pre><code>## GEOGCRS["WGS 84", DATUM["World Geodetic System 1984", ELLIPSOID["WGS
## 84", 6378137, 298.257223563, LENGTHUNIT["metre", 1]], ID["EPSG",
## 6326]], PRIMEM["Greenwich", 0, ANGLEUNIT["degree", 0.0174532925199433],
## ID["EPSG", 8901]], CS[ellipsoidal, 2], AXIS["longitude", east,
## ORDER[1], ANGLEUNIT["degree", 0.0174532925199433, ID["EPSG", 9122]]],
## AXIS["latitude", north, ORDER[2], ANGLEUNIT["degree",
## 0.0174532925199433, ID["EPSG", 9122]]], USAGE[ SCOPE["unknown"],
## AREA["World"], BBOX[-90, -180, 90, 180]]]</code></pre>
<div class="sourceCode" id="cb43"><html><body><pre class="r">## [1] "GEOGCRS[\"WGS 84\", DATUM[\"World Geodetic System 1984\", ELLIPSOID[\"WGS 84\", 
## 6378137, 298.257223563, LENGTHUNIT[\"metre\", 1]], ID[\"EPSG\", 6326]],
## PRIMEM[\"Greenwich\", 0, ANGLEUNIT[\"degree\", 0.0174532925199433], ID[\"EPSG\",
## 8901]], CS[ellipsoidal, 2], AXIS[\"longitude\", east, ORDER[1], ANGLEUNIT[\"degree\",
## 0.0174532925199433, ID[\"EPSG\", 9122]]], AXIS[\"latitude\", north, ORDER[2],
## ANGLEUNIT[\"degree\", 0.0174532925199433, ID[\"EPSG\", 9122]]],
## USAGE[SCOPE[\"unknown\"], AREA[\"World\"], BBOX[-90, -180, 90, 180]]]"</pre></body></html></div>
<div class="sourceCode" id="cb44"><html><body><pre class="r">## PROJ4/GDAL2 CRS arguments:
## PROJ4/GDAL2  +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
## PROJ4/GDAL2 +towgs84=0,0,0</pre></body></html></div>
<p>An early warning of difficulties with discarded <code>+datum</code> values came with the GB datum:</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r">(<span class="no">crs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+init=epsg:27700"</span>))</pre></body></html></div>
<div class="sourceCode" id="cb46"><html><body><pre class="r">## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"):
## Discarded datum OSGB_1936 in CRS definition

## CRS arguments:
##  +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
## +y_0=-100000 +ellps=airy +units=m +no_defs</pre></body></html></div>
<p>Here, the comment has all the information that would be needed to carry out coordinate operations, but the PROJ string is defective for GDAL3/PROJ6, giving at best ballpark accuracy.</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">","</span>, <span class="st">", "</span>, (<span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="no">crs</span>)))), <span class="kw">sep</span><span class="kw">=</span><span class="st">"\n"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb48"><html><body><pre class="r">## [1] "PROJCRS[\"OSGB 1936 / British National Grid\", BASEGEOGCRS[\"OSGB 1936\",
## DATUM[\"OSGB 1936\", ELLIPSOID[\"Airy 1830\", 6377563.396, 299.3249646,
## LENGTHUNIT[\"metre\", 1]]], PRIMEM[\"Greenwich\", 0, ANGLEUNIT[\"degree\",
## 0.0174532925199433]], ID[\"EPSG\", 4277]], CONVERSION[\"British National Grid\",
## METHOD[\"Transverse Mercator\", ID[\"EPSG\", 9807]], PARAMETER[\"Latitude of natural
## origin\", 49, ANGLEUNIT[\"degree\", 0.0174532925199433], ID[\"EPSG\", 8801]],
## PARAMETER[\"Longitude of natural origin\", -2, ANGLEUNIT[\"degree\",
## 0.0174532925199433], ID[\"EPSG\", 8802]], PARAMETER[\"Scale factor at natural
## origin\", 0.9996012717, SCALEUNIT[\"unity\", 1], ID[\"EPSG\", 8805]],
## PARAMETER[\"False easting\", 400000, LENGTHUNIT[\"metre\", 1], ID[\"EPSG\", 8806]],
## PARAMETER[\"False northing\", -100000, LENGTHUNIT[\"metre\", 1], ID[\"EPSG\", 8807]],
## ID[\"EPSG\", 19916]], CS[Cartesian, 2], AXIS[\"(E)\", east, ORDER[1],
## LENGTHUNIT[\"metre\", 1, ID[\"EPSG\", 9001]]], AXIS[\"(N)\", north, ORDER[2],
## LENGTHUNIT[\"metre\", 1, ID[\"EPSG\", 9001]]], USAGE[SCOPE[\"unknown\"], AREA[\"UK -
## Britain and UKCS 49°46'N to 61°01'N,  7°33'W to 3°33'E\"], BBOX[49.75, -9.2, 61.14, 2.88]]]"</pre></body></html></div>
<p>In PROJ4/GDAL2, the <code>+datum</code> and <code>+towgs84</code> values give much better transformation accuracy from the PROJ string.</p>
<div class="sourceCode" id="cb49"><html><body><pre class="r">## PROJ4/GDAL2 CRS arguments:
## PROJ4/GDAL2  +init=epsg:27700 +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717
## PROJ4/GDAL2 +x_0=400000 +y_0=-100000 +datum=OSGB36 +units=m +no_defs
## PROJ4/GDAL2 +ellps=airy
## PROJ4/GDAL2 +towgs84=446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894</pre></body></html></div>
<p>From <strong>sp</strong> 1.3-3 (my fork), <code><a href="../reference/CRS-class.html">CRS()</a></code> takes a third argument to the legacy two, <code>projargs=</code> and <code>doCheckCRSArgs=TRUE</code>: <code>SRS_string=NULL</code>. This can take any string that <code><a href="../reference/showWKT.html">rgdal::showSRID()</a></code> can handle. The warning follows use of <code>exportToProj4()</code>:</p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="no">run</span> <span class="kw">&lt;-</span> <span class="kw pkg">rgdal</span><span class="kw ns">::</span><span class="fu"><a href="../reference/projInfo.html">new_proj_and_gdal</a></span>()</pre></body></html></div>
<div class="sourceCode" id="cb51"><html><body><pre class="r">(<span class="no">crs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="kw">SRS_string</span> <span class="kw">=</span> <span class="st">"EPSG:27700"</span>))</pre></body></html></div>
<pre><code>## Warning in showSRID(SRS_string, format = "PROJ", multiline = "NO"): Discarded
## datum OSGB_1936 in CRS definition</code></pre>
<pre><code>## CRS arguments:
##  +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
## +y_0=-100000 +ellps=airy +units=m +no_defs</code></pre>
<div class="sourceCode" id="cb54"><html><body><pre class="r">## Warning in showSRID(SRS_string, format = "PROJ", multiline = "NO"):
## Discarded datum OSGB_1936 in CRS definition

## CRS arguments:
##  +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
## +y_0=-100000 +ellps=airy +units=m +no_defs</pre></body></html></div>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">","</span>, <span class="st">", "</span>, (<span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="no">crs</span>)))), <span class="kw">sep</span><span class="kw">=</span><span class="st">"\n"</span>)</pre></body></html></div>
<pre><code>## PROJCRS["OSGB 1936 / British National Grid", BASEGEOGCRS["OSGB 1936",
## DATUM["OSGB 1936", ELLIPSOID["Airy 1830", 6377563.396, 299.3249646,
## LENGTHUNIT["metre", 1]]], PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
## 0.0174532925199433]], ID["EPSG", 4277]], CONVERSION["British National
## Grid", METHOD["Transverse Mercator", ID["EPSG", 9807]],
## PARAMETER["Latitude of natural origin", 49, ANGLEUNIT["degree",
## 0.0174532925199433], ID["EPSG", 8801]], PARAMETER["Longitude of natural
## origin", -2, ANGLEUNIT["degree", 0.0174532925199433], ID["EPSG",
## 8802]], PARAMETER["Scale factor at natural origin", 0.9996012717,
## SCALEUNIT["unity", 1], ID["EPSG", 8805]], PARAMETER["False easting",
## 400000, LENGTHUNIT["metre", 1], ID["EPSG", 8806]], PARAMETER["False
## northing", -100000, LENGTHUNIT["metre", 1], ID["EPSG", 8807]],
## ID["EPSG", 19916]], CS[Cartesian, 2], AXIS["(E)", east, ORDER[1],
## LENGTHUNIT["metre", 1, ID["EPSG", 9001]]], AXIS["(N)", north, ORDER[2],
## LENGTHUNIT["metre", 1, ID["EPSG", 9001]]], USAGE[ SCOPE["unknown"],
## AREA["UK - Britain and UKCS 49°46'N to 61°01'N, 7°33'W to 3°33'E"],
## BBOX[49.75, -9.2, 61.14, 2.88]]]</code></pre>
<div class="sourceCode" id="cb57"><html><body><pre class="r">## [1] "PROJCRS[\"OSGB 1936 / British National Grid\", BASEGEOGCRS[\"OSGB 1936\",
## DATUM[\"OSGB 1936\", ELLIPSOID[\"Airy 1830\", 6377563.396, 299.3249646,
## LENGTHUNIT[\"metre\", 1]]], PRIMEM[\"Greenwich\", 0, ANGLEUNIT[\"degree\",
## 0.0174532925199433]], ID[\"EPSG\", 4277]], CONVERSION[\"British National Grid\",
## METHOD[\"Transverse Mercator\", ID[\"EPSG\", 9807]], PARAMETER[\"Latitude of natural
## origin\", 49, ANGLEUNIT[\"degree\", 0.0174532925199433], ID[\"EPSG\", 8801]],
## PARAMETER[\"Longitude of natural origin\", -2, ANGLEUNIT[\"degree\",
## 0.0174532925199433], ID[\"EPSG\", 8802]], PARAMETER[\"Scale factor at natural
## origin\", 0.9996012717, SCALEUNIT[\"unity\", 1], ID[\"EPSG\", 8805]],
## PARAMETER[\"False easting\", 400000, LENGTHUNIT[\"metre\", 1], ID[\"EPSG\", 8806]],
## PARAMETER[\"False northing\", -100000, LENGTHUNIT[\"metre\", 1], ID[\"EPSG\", 8807]]],
## CS[Cartesian, 2], AXIS[\"(E)\", east, ORDER[1], LENGTHUNIT[\"metre\", 1]],
## AXIS[\"(N)\", north, ORDER[2], LENGTHUNIT[\"metre\", 1]], USAGE[SCOPE[\"unknown\"],
## AREA[\"UK - Britain and UKCS 49°46'N to 61°01'N,  7°33'W to 3°33'E\"], BBOX[49.75,
## -9.2, 61.14, 2.88]], ID[\"EPSG\", 27700]]"</pre></body></html></div>
<p>We can also use a more detailed PROJ string, but without any improvement of the output PROJ representation; the comment is OK:</p>
<div class="sourceCode" id="cb58"><html><body><pre class="r">(<span class="no">crs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +datum=OSGB36 +units=m +no_defs"</span>))</pre></body></html></div>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
## datum OSGB_1936 in CRS definition</code></pre>
<pre><code>## CRS arguments:
##  +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
## +y_0=-100000 +ellps=airy +units=m +no_defs</code></pre>
<div class="sourceCode" id="cb61"><html><body><pre class="r">## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"):
## Discarded datum OSGB_1936 in CRS definition

## CRS arguments:
##  +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
## +y_0=-100000 +ellps=airy +units=m +no_defs</pre></body></html></div>
<div class="sourceCode" id="cb62"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">","</span>, <span class="st">", "</span>, (<span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="no">crs</span>)))), <span class="kw">sep</span><span class="kw">=</span><span class="st">"\n"</span>)</pre></body></html></div>
<pre><code>## PROJCRS["unknown", BASEGEOGCRS["unknown", DATUM["OSGB 1936",
## ELLIPSOID["Airy 1830", 6377563.396, 299.3249646, LENGTHUNIT["metre",
## 1]], ID["EPSG", 6277]], PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
## 0.0174532925199433], ID["EPSG", 8901]]], CONVERSION["unknown",
## METHOD["Transverse Mercator", ID["EPSG", 9807]], PARAMETER["Latitude of
## natural origin", 49, ANGLEUNIT["degree", 0.0174532925199433],
## ID["EPSG", 8801]], PARAMETER["Longitude of natural origin", -2,
## ANGLEUNIT["degree", 0.0174532925199433], ID["EPSG", 8802]],
## PARAMETER["Scale factor at natural origin", 0.9996012717,
## SCALEUNIT["unity", 1], ID["EPSG", 8805]], PARAMETER["False easting",
## 400000, LENGTHUNIT["metre", 1], ID["EPSG", 8806]], PARAMETER["False
## northing", -100000, LENGTHUNIT["metre", 1], ID["EPSG", 8807]]],
## CS[Cartesian, 2], AXIS["(E)", east, ORDER[1], LENGTHUNIT["metre", 1,
## ID["EPSG", 9001]]], AXIS["(N)", north, ORDER[2], LENGTHUNIT["metre", 1,
## ID["EPSG", 9001]]]]</code></pre>
<div class="sourceCode" id="cb64"><html><body><pre class="r">## [1] "PROJCRS[\"unknown\", BASEGEOGCRS[\"unknown\", DATUM[\"OSGB 1936\",
## ELLIPSOID[\"Airy 1830\", 6377563.396, 299.3249646, LENGTHUNIT[\"metre\", 1]],
## ID[\"EPSG\", 6277]], PRIMEM[\"Greenwich\", 0, ANGLEUNIT[\"degree\",
## 0.0174532925199433], ID[\"EPSG\", 8901]]], CONVERSION[\"unknown\", METHOD[\"Transverse
## Mercator\", ID[\"EPSG\", 9807]], PARAMETER[\"Latitude of natural origin\", 49,
## ANGLEUNIT[\"degree\", 0.0174532925199433], ID[\"EPSG\", 8801]], PARAMETER[\"Longitude
## of natural origin\", -2, ANGLEUNIT[\"degree\", 0.0174532925199433], ID[\"EPSG\",
## 8802]], PARAMETER[\"Scale factor at natural origin\", 0.9996012717,
## SCALEUNIT[\"unity\", 1], ID[\"EPSG\", 8805]], PARAMETER[\"False easting\", 400000,
## LENGTHUNIT[\"metre\", 1], ID[\"EPSG\", 8806]], PARAMETER[\"False northing\", -100000,
## LENGTHUNIT[\"metre\", 1], ID[\"EPSG\", 8807]]], CS[Cartesian, 2], AXIS[\"(E)\", east,
## ORDER[1], LENGTHUNIT[\"metre\", 1, ID[\"EPSG\", 9001]]], AXIS[\"(N)\", north,
## ORDER[2], LENGTHUNIT[\"metre\", 1, ID[\"EPSG\", 9001]]]]"</pre></body></html></div>
<p><code><a href="../reference/showWKT.html">rgdal::showSRID()</a></code> is quite versatile, so we can display a multiline WKT string as well:</p>
<div class="sourceCode" id="cb65"><html><body><pre class="r"><span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span>(<span class="st">"rgdal"</span>) <span class="kw">&gt;=</span> <span class="st">"1.5.1"</span>) <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="kw pkg">rgdal</span><span class="kw ns">::</span><span class="fu"><a href="../reference/showWKT.html">showSRID</a></span>(<span class="st">"+init=epsg:27700"</span>, <span class="kw">format</span><span class="kw">=</span><span class="st">"WKT2_2018"</span>, <span class="kw">multiline</span><span class="kw">=</span><span class="st">"YES"</span>), <span class="st">"\n"</span>)</pre></body></html></div>
<pre><code>## PROJCRS["OSGB 1936 / British National Grid",
##     BASEGEOGCRS["OSGB 1936",
##         DATUM["OSGB 1936",
##             ELLIPSOID["Airy 1830",6377563.396,299.3249646,
##                 LENGTHUNIT["metre",1]]],
##         PRIMEM["Greenwich",0,
##             ANGLEUNIT["degree",0.0174532925199433]],
##         ID["EPSG",4277]],
##     CONVERSION["British National Grid",
##         METHOD["Transverse Mercator",
##             ID["EPSG",9807]],
##         PARAMETER["Latitude of natural origin",49,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8801]],
##         PARAMETER["Longitude of natural origin",-2,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8802]],
##         PARAMETER["Scale factor at natural origin",0.9996012717,
##             SCALEUNIT["unity",1],
##             ID["EPSG",8805]],
##         PARAMETER["False easting",400000,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8806]],
##         PARAMETER["False northing",-100000,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8807]],
##         ID["EPSG",19916]],
##     CS[Cartesian,2],
##         AXIS["(E)",east,
##             ORDER[1],
##             LENGTHUNIT["metre",1,
##                 ID["EPSG",9001]]],
##         AXIS["(N)",north,
##             ORDER[2],
##             LENGTHUNIT["metre",1,
##                 ID["EPSG",9001]]],
##     USAGE[
##         SCOPE["unknown"],
##         AREA["UK - Britain and UKCS 49°46'N to 61°01'N, 7°33'W to 3°33'E"],
##         BBOX[49.75,-9.2,61.14,2.88]]]</code></pre>
<div class="sourceCode" id="cb67"><html><body><pre class="r">## PROJCRS["OSGB 1936 / British National Grid",
##     BASEGEOGCRS["OSGB 1936",
##         DATUM["OSGB 1936",
##             ELLIPSOID["Airy 1830",6377563.396,299.3249646,
##                 LENGTHUNIT["metre",1]]],
##         PRIMEM["Greenwich",0,
##             ANGLEUNIT["degree",0.0174532925199433]],
##         ID["EPSG",4277]],
##     CONVERSION["British National Grid",
##         METHOD["Transverse Mercator",
##             ID["EPSG",9807]],
##         PARAMETER["Latitude of natural origin",49,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8801]],
##         PARAMETER["Longitude of natural origin",-2,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8802]],
##         PARAMETER["Scale factor at natural origin",0.9996012717,
##             SCALEUNIT["unity",1],
##             ID["EPSG",8805]],
##         PARAMETER["False easting",400000,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8806]],
##         PARAMETER["False northing",-100000,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8807]],
##         ID["EPSG",19916]],
##     CS[Cartesian,2],
##         AXIS["(E)",east,
##             ORDER[1],
##             LENGTHUNIT["metre",1,
##                 ID["EPSG",9001]]],
##         AXIS["(N)",north,
##             ORDER[2],
##             LENGTHUNIT["metre",1,
##                 ID["EPSG",9001]]],
##     USAGE[
##         SCOPE["unknown"],
##         AREA["UK - Britain and UKCS 49°46'N to 61°01'N, 7°33'W to 3°33'E"],
##         BBOX[49.75,-9.2,61.14,2.88]]]</pre></body></html></div>
<p>So far, <code>"CRS"</code> objects created on creation from <strong>sp</strong>, and from reading rasters and vectors in <strong>rgdal</strong>, are furnished with WKT comments. These are used to instantiate SRS objects when writing raster and vector objects. What remains is to convert the compiled <code><a href="https://rdrr.io/r/base/transform.html">transform()</a></code> function and <code><a href="../reference/spTransform-methods.html">spTransform()</a></code> methods to use the WKT comments if available instead of the PROJ string in the <code>"CRS"</code> object in each <code>"Spatial"</code> object.</p>
</div>
<div id="coordinate-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#coordinate-operations" class="anchor"></a>Coordinate operations</h2>
<div class="sourceCode" id="cb68"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rgdal</span>)</pre></body></html></div>
<pre><code>## rgdal: version: 1.5-10, (SVN revision 1002M)
## Geospatial Data Abstraction Library extensions to R successfully loaded
## Loaded GDAL runtime: GDAL 3.1.0, released 2020/05/03
## Path to GDAL shared files: /usr/local/share/gdal
## GDAL binary built with GEOS: TRUE 
## Loaded PROJ runtime: Rel. 7.0.1, May 1st, 2020, [PJ_VERSION: 701]
## Path to PROJ shared files: /home/rsb/.local/share/proj:/usr/local/share/proj:/usr/local/share/proj
## PROJ CDN enabled:FALSE
## Linking to sp version:1.4-2
## To mute warnings of possible GDAL/OSR exportToProj4() degradation,
## use options("rgdal_show_exportToProj4_warnings"="none") before loading rgdal.</code></pre>
<div class="sourceCode" id="cb70"><html><body><pre class="r">## rgdal: version: 1.5-1, (SVN revision 870)
##  Geospatial Data Abstraction Library extensions to R successfully loaded
##  Loaded GDAL runtime: GDAL 3.0.2, released 2019/10/28
##  Path to GDAL shared files: 
##  GDAL binary built with GEOS: TRUE 
##  Loaded PROJ.4 runtime: Rel. 6.2.1, November 1st, 2019, [PJ_VERSION: 621]
##  Path to PROJ.4 shared files: (autodetected)
##  Linking to sp version: 1.3-3</pre></body></html></div>
<div class="sourceCode" id="cb71"><html><body><pre class="r"><span class="no">run</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/projInfo.html">new_proj_and_gdal</a></span>()</pre></body></html></div>
<p>We can first show what happens when searching for instantiable coordinate operations. These are coordinate operations that can be created by look-up in the PROJ database given the information in the input description. Here the datum has been discarded.</p>
<div class="sourceCode" id="cb72"><html><body><pre class="r">(<span class="no">discarded_datum</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/showWKT.html">showSRID</a></span>(<span class="st">"EPSG:27700"</span>, <span class="st">"PROJ"</span>))</pre></body></html></div>
<pre><code>## Warning in showSRID("EPSG:27700", "PROJ"): Discarded datum OSGB_1936 in CRS
## definition</code></pre>
<pre><code>## [1] "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs"</code></pre>
<div class="sourceCode" id="cb75"><html><body><pre class="r">## Warning in showSRID("EPSG:27700", "PROJ"): Discarded datum OSGB_1936 in CRS
## definition</pre></body></html></div>
<p>Consequently, when searching for coordinate operations to transform to geographical coordinates and the WGS84 datum, and using <code>importFromProj4()</code> to instantiate the source SRS, the only operation found only has the Airy ellipse information to guide its search. The <code><a href="../reference/list_coordOps.html">list_coordOps()</a></code> function takes two SRS descriptions, and returns coordinate operations found by look-up. We need to add the <code>type</code> tag to a PROJ string here.</p>
<div class="sourceCode" id="cb76"><html><body><pre class="r">(<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/list_coordOps.html">list_coordOps</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">discarded_datum</span>, <span class="st">" +type=crs"</span>), <span class="st">"EPSG:4326"</span>))</pre></body></html></div>
<pre><code>## Candidate coordinate operations found:  1 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
##         +y_0=-100000 +ellps=airy +units=m +no_defs +type=crs
## Target: EPSG:4326 
## Best instantiable operation has only ballpark accuracy 
## Description: Inverse of unknown + Ballpark geographic offset from unknown to
##              WGS 84 + axis order change (2D)
## Definition:  +proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2
##              +k=0.9996012717 +x_0=400000 +y_0=-100000
##              +ellps=airy +step +proj=unitconvert +xy_in=rad
##              +xy_out=deg</code></pre>
<div class="sourceCode" id="cb78"><html><body><pre class="r">## Candidate coordinate operations found:  1 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
##         +y_0=-100000 +ellps=airy +units=m +no_defs +type=crs
## Target: EPSG:4326 
## Best instantiable operation has only ballpark accuracy 
## Description: Inverse of unknown + Ballpark geographic offset from unknown to
##              WGS 84 + axis order change (2D)
## Definition:  +proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2
##              +k=0.9996012717 +x_0=400000 +y_0=-100000
##              +ellps=airy +step +proj=unitconvert +xy_in=rad
##              +xy_out=deg</pre></body></html></div>
<p>The <code><a href="../reference/list_coordOps.html">best_instantiable_coordOp()</a></code> function retuns the best instantiable coordinate operation, in this case the only one, with a description attribute. This is the current best available in calling <code><a href="../reference/spTransform-methods.html">spTransform()</a></code> with <code>"CRS"</code> objects with discarded <code>+datum=</code> tags.</p>
<div class="sourceCode" id="cb79"><html><body><pre class="r"><span class="fu"><a href="../reference/list_coordOps.html">best_instantiable_coordOp</a></span>(<span class="no">x</span>)</pre></body></html></div>
<pre><code>## Warning in best_instantiable_coordOp(x): Best instantiable operation has only
## ballpark accuracy</code></pre>
<pre><code>## [1] "+proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +step +proj=unitconvert +xy_in=rad +xy_out=deg"
## attr(,"description")
## [1] "Inverse of unknown + Ballpark geographic offset from unknown to WGS 84 + axis order change (2D)"</code></pre>
<div class="sourceCode" id="cb82"><html><body><pre class="r">## Warning in best_instantiable_coordOp(x): Best instantiable operation has only
## ballpark accuracy
## [1] "+proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717
## +x_0=400000 +y_0=-100000 +ellps=airy +step +proj=unitconvert +xy_in=rad +xy_out=deg"
## attr(,"description")
## [1] "Inverse of unknown + Ballpark geographic offset from unknown to WGS 84 + 
## axis order change (2D)"</pre></body></html></div>
<p>If we add back the discarded <code>+datum=</code> tag with a valid value, we give the search process what it needs to find more coordinate operations.</p>
<div class="sourceCode" id="cb83"><html><body><pre class="r"><span class="fu"><a href="../reference/list_coordOps.html">list_coordOps</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">discarded_datum</span>, <span class="st">" +datum=OSGB36 +type=crs"</span>), <span class="st">"EPSG:4326"</span>)</pre></body></html></div>
<pre><code>## Candidate coordinate operations found:  8 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
##         +y_0=-100000 +ellps=airy +units=m +no_defs
##         +datum=OSGB36 +type=crs
## Target: EPSG:4326 
## Best instantiable operation has accuracy: 2 m
## Description: Inverse of unknown + axis order change (2D) + OSGB 1936 to WGS
##              84 (6) + axis order change (2D)
## Definition:  +proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2
##              +k=0.9996012717 +x_0=400000 +y_0=-100000
##              +ellps=airy +step +proj=push +v_3 +step +proj=cart
##              +ellps=airy +step +proj=helmert +x=446.448
##              +y=-125.157 +z=542.06 +rx=0.15 +ry=0.247 +rz=0.842
##              +s=-20.489 +convention=position_vector +step +inv
##              +proj=cart +ellps=WGS84 +step +proj=pop +v_3 +step
##              +proj=unitconvert +xy_in=rad +xy_out=deg
## Operation 7 is lacking 1 grid with accuracy 1 m
## Missing grid: uk_os_OSTN15_NTv2_OSGBtoETRS.tif 
## URL: https://cdn.proj.org/uk_os_OSTN15_NTv2_OSGBtoETRS.tif</code></pre>
<p>Now we have 7 operations, one the ballpark accuracy operation with unknown accuracy found above, 5 others that can be instantiated, of which the best has 2m accuracy, and an operation that cannot be instantiated because a publically available grid is missing. On download and installation of this grid, 1m accuracy could be achieved.</p>
<div class="sourceCode" id="cb85"><html><body><pre class="r">## Candidate coordinate operations found:  7 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
##         +y_0=-100000 +ellps=airy +units=m +no_defs
##         +datum=OSGB36 +type=crs
## Target: EPSG:4326 
## Best instantiable operation has accuracy: 2 m
## Description: Inverse of unknown + axis order change (2D) + OSGB 1936 to WGS
##              84 (6) + axis order change (2D)
## Definition:  +proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2
##              +k=0.9996012717 +x_0=400000 +y_0=-100000
##              +ellps=airy +step +proj=push +v_3 +step +proj=cart
##              +ellps=airy +step +proj=helmert +x=446.448
##              +y=-125.157 +z=542.06 +rx=0.15 +ry=0.247 +rz=0.842
##              +s=-20.489 +convention=position_vector +step +inv
##              +proj=cart +ellps=WGS84 +step +proj=pop +v_3 +step
##              +proj=unitconvert +xy_in=rad +xy_out=deg
## Operation 6 is lacking 1 grid with accuracy 1 m
## Missing grid: OSTN15_NTv2_OSGBtoETRS.gsb 
## URL: https://download.osgeo.org/proj/proj-datumgrid-europe-latest.zip</pre></body></html></div>
<p>If we pass the source WKT string to <code><a href="../reference/list_coordOps.html">list_coordOps()</a></code> we get 6 operations back, now without the ballpark accuracy operation; this would be the situation in which WKT comments if present were used to construct the source and target SRS:</p>
<div class="sourceCode" id="cb86"><html><body><pre class="r"><span class="no">wkt_source_datum</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/showWKT.html">showSRID</a></span>(<span class="st">"EPSG:27700"</span>, <span class="st">"WKT2"</span>)
<span class="no">wkt_target_datum</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/showWKT.html">showSRID</a></span>(<span class="st">"EPSG:4326"</span>, <span class="st">"WKT2"</span>)
(<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/list_coordOps.html">list_coordOps</a></span>(<span class="no">wkt_source_datum</span>, <span class="no">wkt_target_datum</span>))</pre></body></html></div>
<pre><code>## Candidate coordinate operations found:  8 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: PROJCRS["OSGB 1936 / British National Grid", BASEGEOGCRS["OSGB
##         1936", DATUM["OSGB 1936", ELLIPSOID["Airy 1830",
##         6377563.396, 299.3249646, LENGTHUNIT["metre", 1]]],
##         PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
##         0.0174532925199433]], ID["EPSG", 4277]],
##         CONVERSION["British National Grid", METHOD["Transverse
##         Mercator", ID["EPSG", 9807]], PARAMETER["Latitude of
##         natural origin", 49, ANGLEUNIT["degree",
##         0.0174532925199433], ID["EPSG", 8801]],
##         PARAMETER["Longitude of natural origin", -2,
##         ANGLEUNIT["degree", 0.0174532925199433], ID["EPSG",
##         8802]], PARAMETER["Scale factor at natural origin",
##         0.9996012717, SCALEUNIT["unity", 1], ID["EPSG", 8805]],
##         PARAMETER["False easting", 400000, LENGTHUNIT["metre",
##         1], ID["EPSG", 8806]], PARAMETER["False northing",
##         -100000, LENGTHUNIT["metre", 1], ID["EPSG", 8807]],
##         ID["EPSG", 19916]], CS[Cartesian, 2], AXIS["(E)", east,
##         ORDER[1], LENGTHUNIT["metre", 1, ID["EPSG", 9001]]],
##         AXIS["(N)", north, ORDER[2], LENGTHUNIT["metre", 1,
##         ID["EPSG", 9001]]], USAGE[SCOPE["unknown"], AREA["UK -
##         Britain and UKCS 49°46'N to 61°01'N, 7°33'W to
##         3°33'E"], BBOX[49.75, -9.2, 61.14, 2.88]]]
## Target:
## GEOGCRS["WGS 84", DATUM["World Geodetic System 1984",
##         ELLIPSOID["WGS 84", 6378137, 298.257223563,
##         LENGTHUNIT["metre", 1]], ID["EPSG", 6326]],
##         PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
##         0.0174532925199433], ID["EPSG", 8901]], CS[ellipsoidal,
##         2], AXIS["longitude", east, ORDER[1],
##         ANGLEUNIT["degree", 0.0174532925199433, ID["EPSG",
##         9122]]], AXIS["latitude", north, ORDER[2],
##         ANGLEUNIT["degree", 0.0174532925199433, ID["EPSG",
##         9122]]], USAGE[SCOPE["unknown"], AREA["World"],
##         BBOX[-90, -180, 90, 180]]]
## Best instantiable operation has accuracy: 2 m
## Description: Inverse of British National Grid + OSGB 1936 to WGS 84 (6) +
##              axis order change (2D)
## Definition:  +proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2
##              +k=0.9996012717 +x_0=400000 +y_0=-100000
##              +ellps=airy +step +proj=push +v_3 +step +proj=cart
##              +ellps=airy +step +proj=helmert +x=446.448
##              +y=-125.157 +z=542.06 +rx=0.15 +ry=0.247 +rz=0.842
##              +s=-20.489 +convention=position_vector +step +inv
##              +proj=cart +ellps=WGS84 +step +proj=pop +v_3 +step
##              +proj=unitconvert +xy_in=rad +xy_out=deg
## Operation 7 is lacking 1 grid with accuracy 1 m
## Missing grid: uk_os_OSTN15_NTv2_OSGBtoETRS.tif 
## URL: https://cdn.proj.org/uk_os_OSTN15_NTv2_OSGBtoETRS.tif</code></pre>
<div class="sourceCode" id="cb88"><html><body><pre class="r">## Candidate coordinate operations found:  6 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: PROJCRS["OSGB 1936 / British National Grid", BASEGEOGCRS["OSGB
##         1936", DATUM["OSGB 1936", ELLIPSOID["Airy 1830",
##         6377563.396, 299.3249646, LENGTHUNIT["metre", 1]]],
##         PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
##         0.0174532925199433]], ID["EPSG", 4277]],
##         CONVERSION["British National Grid", METHOD["Transverse
##         Mercator", ID["EPSG", 9807]], PARAMETER["Latitude of
##         natural origin", 49, ANGLEUNIT["degree",
##         0.0174532925199433], ID["EPSG", 8801]],
##         PARAMETER["Longitude of natural origin", -2,
##         ANGLEUNIT["degree", 0.0174532925199433], ID["EPSG",
##         8802]], PARAMETER["Scale factor at natural origin",
##         0.9996012717, SCALEUNIT["unity", 1], ID["EPSG", 8805]],
##         PARAMETER["False easting", 400000, LENGTHUNIT["metre",
##         1], ID["EPSG", 8806]], PARAMETER["False northing",
##         -100000, LENGTHUNIT["metre", 1], ID["EPSG", 8807]]],
##         CS[Cartesian, 2], AXIS["(E)", east, ORDER[1],
##         LENGTHUNIT["metre", 1]], AXIS["(N)", north, ORDER[2],
##         LENGTHUNIT["metre", 1]], USAGE[SCOPE["unknown"],
##         AREA["UK - Britain and UKCS 49°46'N to 61°01'N, 7°33'W
##         to 3°33'E"], BBOX[49.75, -9.2, 61.14, 2.88]],
##         ID["EPSG", 27700]]
## Target: GEOGCRS["WGS 84", DATUM["World Geodetic System 1984",
##         ELLIPSOID["WGS 84", 6378137, 298.257223563,
##         LENGTHUNIT["metre", 1]]], PRIMEM["Greenwich", 0,
##         ANGLEUNIT["degree", 0.0174532925199433]],
##         CS[ellipsoidal, 2], AXIS["geodetic latitude (Lat)",
##         north, ORDER[1], ANGLEUNIT["degree",
##         0.0174532925199433]], AXIS["geodetic longitude (Lon)",
##         east, ORDER[2], ANGLEUNIT["degree",
##         0.0174532925199433]], USAGE[SCOPE["unknown"],
##         AREA["World"], BBOX[-90, -180, 90, 180]], ID["EPSG",
##         4326]]
## Best instantiable operation has accuracy: 2 m
## Description: Inverse of British National Grid + OSGB 1936 to WGS 84 (6) +
##              axis order change (2D)
## Definition:  +proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2
##              +k=0.9996012717 +x_0=400000 +y_0=-100000
##              +ellps=airy +step +proj=push +v_3 +step +proj=cart
##              +ellps=airy +step +proj=helmert +x=446.448
##              +y=-125.157 +z=542.06 +rx=0.15 +ry=0.247 +rz=0.842
##              +s=-20.489 +convention=position_vector +step +inv
##              +proj=cart +ellps=WGS84 +step +proj=pop +v_3 +step
##              +proj=unitconvert +xy_in=rad +xy_out=deg
## Operation 6 is lacking 1 grid with accuracy 1 m
## Missing grid: OSTN15_NTv2_OSGBtoETRS.gsb 
## URL: https://download.osgeo.org/proj/proj-datumgrid-europe-latest.zip</pre></body></html></div>
<div class="sourceCode" id="cb89"><html><body><pre class="r"><span class="fu"><a href="../reference/list_coordOps.html">best_instantiable_coordOp</a></span>(<span class="no">x</span>)</pre></body></html></div>
<pre><code>## [1] "+proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +step +proj=push +v_3 +step +proj=cart +ellps=airy +step +proj=helmert +x=446.448 +y=-125.157 +z=542.06 +rx=0.15 +ry=0.247 +rz=0.842 +s=-20.489 +convention=position_vector +step +inv +proj=cart +ellps=WGS84 +step +proj=pop +v_3 +step +proj=unitconvert +xy_in=rad +xy_out=deg"
## attr(,"description")
## [1] "Inverse of British National Grid + OSGB 1936 to WGS 84 (6) + axis order change (2D)"</code></pre>
<div class="sourceCode" id="cb91"><html><body><pre class="r">## [1] "+proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717
## +x_0=400000 +y_0=-100000 +ellps=airy +step +proj=push +v_3 +step +proj=cart
## +ellps=airy +step +proj=helmert +x=446.448 +y=-125.157 +z=542.06 +rx=0.15 +ry=0.247
## +rz=0.842 +s=-20.489 +convention=position_vector +step +inv +proj=cart +ellps=WGS84
## +step +proj=pop +v_3 +step +proj=unitconvert +xy_in=rad +xy_out=deg"
## attr(,"description")
## [1] "Inverse of British National Grid + OSGB 1936 to WGS 84 (6) + axis order change (2D)"</pre></body></html></div>
<p>Turning to a different example, a Brazilian UTM25S Corrego Alegre 1970-72 datum, and looking for coordinate operations transform to UTM25S SIRGAS 2000, we see that a <code>+towgs84=</code> tag was preserved.</p>
<div class="sourceCode" id="cb92"><html><body><pre class="r"><span class="no">discarded_datum</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/showWKT.html">showSRID</a></span>(<span class="st">"EPSG:22525"</span>, <span class="st">"PROJ"</span>)</pre></body></html></div>
<pre><code>## Warning in showSRID("EPSG:22525", "PROJ"): Discarded datum
## Corrego_Alegre_1970-72 in CRS definition</code></pre>
<div class="sourceCode" id="cb94"><html><body><pre class="r">## Warning in showSRID("EPSG:22525", "PROJ"): Discarded datum Corrego_Alegre_1970-72 in CRS definition,
##  but +towgs84= values preserved</pre></body></html></div>
<p>This meant that while only ballpark accuracy is reported, a Helmert transformation is carried out:</p>
<div class="sourceCode" id="cb95"><html><body><pre class="r">(<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/list_coordOps.html">list_coordOps</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">discarded_datum</span>, <span class="st">" +type=crs"</span>), <span class="st">"EPSG:31985"</span>))</pre></body></html></div>
<pre><code>## Candidate coordinate operations found:  1 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: +proj=utm +zone=25 +south +ellps=intl +units=m +no_defs
##         +type=crs
## Target: EPSG:31985 
## Best instantiable operation has only ballpark accuracy 
## Description: Inverse of UTM zone 25S + Ballpark geographic offset from
##              unknown to SIRGAS 2000 + UTM zone 25S
## Definition:  +proj=pipeline +step +inv +proj=utm +zone=25 +south +ellps=intl
##              +step +proj=utm +zone=25 +south +ellps=GRS80</code></pre>
<div class="sourceCode" id="cb97"><html><body><pre class="r">## Candidate coordinate operations found:  1 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: +proj=utm +zone=25 +south +ellps=intl
##         +towgs84=-205.57,168.77,-4.12,0,0,0,0 +units=m +no_defs
##         +type=crs
## Target: EPSG:31985 
## Best instantiable operation has only ballpark accuracy 
## Description: Inverse of UTM zone 25S + Transformation from unknown to WGS84
##              + Inverse of SIRGAS 2000 to WGS 84 (1) + UTM zone
##              25S
## Definition:  +proj=pipeline +step +inv +proj=utm +zone=25 +south +ellps=intl
##              +step +proj=push +v_3 +step +proj=cart +ellps=intl
##              +step +proj=helmert +x=-205.57 +y=168.77 +z=-4.12
##              +rx=0 +ry=0 +rz=0 +s=0 +convention=position_vector
##              +step +inv +proj=cart +ellps=GRS80 +step +proj=pop
##              +v_3 +step +proj=utm +zone=25 +south +ellps=GRS80</pre></body></html></div>
<div class="sourceCode" id="cb98"><html><body><pre class="r"><span class="fu"><a href="../reference/list_coordOps.html">best_instantiable_coordOp</a></span>(<span class="no">x</span>)</pre></body></html></div>
<pre><code>## Warning in best_instantiable_coordOp(x): Best instantiable operation has only
## ballpark accuracy</code></pre>
<pre><code>## [1] "+proj=pipeline +step +inv +proj=utm +zone=25 +south +ellps=intl +step +proj=utm +zone=25 +south +ellps=GRS80"
## attr(,"description")
## [1] "Inverse of UTM zone 25S + Ballpark geographic offset from unknown to SIRGAS 2000 + UTM zone 25S"</code></pre>
<div class="sourceCode" id="cb101"><html><body><pre class="r">## Warning in best_instantiable_coordOp(x): Best instantiable operation has only
## ballpark accuracy
## [1] "+proj=pipeline +step +inv +proj=utm +zone=25 +south +ellps=intl +step
## +proj=push +v_3 +step +proj=cart +ellps=intl +step +proj=helmert +x=-205.57
## +y=168.77 +z=-4.12 +rx=0 +ry=0 +rz=0 +s=0 +convention=position_vector +step +inv
## +proj=cart +ellps=GRS80 +step +proj=pop +v_3 +step +proj=utm +zone=25 +south
## +ellps=GRS80"
## attr(,"description")
## [1] "Inverse of UTM zone 25S + Transformation from unknown to WGS84 + Inverse of
## SIRGAS 2000 to WGS 84 (1) + UTM zone 25S"</pre></body></html></div>
<p>If we move to input WKT strings when searching for coordinate operations, we get to the same result with unknown accuracy but using a Helmert transformation:</p>
<div class="sourceCode" id="cb102"><html><body><pre class="r"><span class="no">wkt_source_datum</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/showWKT.html">showSRID</a></span>(<span class="st">"EPSG:22525"</span>, <span class="st">"WKT2"</span>)
<span class="no">wkt_target_datum</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/showWKT.html">showSRID</a></span>(<span class="st">"EPSG:31985"</span>, <span class="st">"WKT2"</span>)
(<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/list_coordOps.html">list_coordOps</a></span>(<span class="no">wkt_source_datum</span>, <span class="no">wkt_target_datum</span>))</pre></body></html></div>
<pre><code>## Candidate coordinate operations found:  2 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: PROJCRS["Corrego Alegre 1970-72 / UTM zone 25S",
##         BASEGEOGCRS["Corrego Alegre 1970-72", DATUM["Corrego
##         Alegre 1970-72", ELLIPSOID["International 1924",
##         6378388, 297, LENGTHUNIT["metre", 1]]],
##         PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
##         0.0174532925199433]], ID["EPSG", 4225]],
##         CONVERSION["UTM zone 25S", METHOD["Transverse
##         Mercator", ID["EPSG", 9807]], PARAMETER["Latitude of
##         natural origin", 0, ANGLEUNIT["degree",
##         0.0174532925199433], ID["EPSG", 8801]],
##         PARAMETER["Longitude of natural origin", -33,
##         ANGLEUNIT["degree", 0.0174532925199433], ID["EPSG",
##         8802]], PARAMETER["Scale factor at natural origin",
##         0.9996, SCALEUNIT["unity", 1], ID["EPSG", 8805]],
##         PARAMETER["False easting", 500000, LENGTHUNIT["metre",
##         1], ID["EPSG", 8806]], PARAMETER["False northing",
##         10000000, LENGTHUNIT["metre", 1], ID["EPSG", 8807]],
##         ID["EPSG", 16125]], CS[Cartesian, 2], AXIS["(E)", east,
##         ORDER[1], LENGTHUNIT["metre", 1, ID["EPSG", 9001]]],
##         AXIS["(N)", north, ORDER[2], LENGTHUNIT["metre", 1,
##         ID["EPSG", 9001]]], USAGE[SCOPE["unknown"],
##         AREA["Brazil - east of 36°W onshore"], BBOX[-10.1, -36,
##         -4.99, -34.74]]]
## Target:
## PROJCRS["SIRGAS 2000 / UTM zone 25S", BASEGEOGCRS["SIRGAS
##         2000", DATUM["Sistema de Referencia Geocentrico para
##         las AmericaS 2000", ELLIPSOID["GRS 1980", 6378137,
##         298.257222101, LENGTHUNIT["metre", 1]]],
##         PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
##         0.0174532925199433]], ID["EPSG", 4674]],
##         CONVERSION["UTM zone 25S", METHOD["Transverse
##         Mercator", ID["EPSG", 9807]], PARAMETER["Latitude of
##         natural origin", 0, ANGLEUNIT["degree",
##         0.0174532925199433], ID["EPSG", 8801]],
##         PARAMETER["Longitude of natural origin", -33,
##         ANGLEUNIT["degree", 0.0174532925199433], ID["EPSG",
##         8802]], PARAMETER["Scale factor at natural origin",
##         0.9996, SCALEUNIT["unity", 1], ID["EPSG", 8805]],
##         PARAMETER["False easting", 500000, LENGTHUNIT["metre",
##         1], ID["EPSG", 8806]], PARAMETER["False northing",
##         10000000, LENGTHUNIT["metre", 1], ID["EPSG", 8807]],
##         ID["EPSG", 16125]], CS[Cartesian, 2], AXIS["(E)", east,
##         ORDER[1], LENGTHUNIT["metre", 1, ID["EPSG", 9001]]],
##         AXIS["(N)", north, ORDER[2], LENGTHUNIT["metre", 1,
##         ID["EPSG", 9001]]], USAGE[SCOPE["unknown"],
##         AREA["Brazil - 36°W to 30°W"], BBOX[-23.8, -36, 4.19,
##         -29.99]]]
## Best instantiable operation has accuracy: 5 m
## Description: Inverse of UTM zone 25S + Corrego Alegre 1970-72 to SIRGAS 2000
##              (2) + UTM zone 25S
## Definition:  +proj=pipeline +step +inv +proj=utm +zone=25 +south +ellps=intl
##              +step +proj=push +v_3 +step +proj=cart +ellps=intl
##              +step +proj=helmert +x=-206.05 +y=168.28 +z=-3.82
##              +step +inv +proj=cart +ellps=GRS80 +step +proj=pop
##              +v_3 +step +proj=utm +zone=25 +south +ellps=GRS80
## Operation 2 is lacking 1 grid with accuracy 2 m
## Missing grid: CA7072_003.gsb</code></pre>
<div class="sourceCode" id="cb104"><html><body><pre class="r">## Candidate coordinate operations found:  1 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: BOUNDCRS[SOURCECRS[PROJCRS["Corrego Alegre 1970-72 / UTM zone
##         25S", BASEGEOGCRS["Corrego Alegre 1970-72",
##         DATUM["Corrego Alegre 1970-72",
##         ELLIPSOID["International 1924", 6378388, 297,
##         LENGTHUNIT["metre", 1]]], PRIMEM["Greenwich", 0,
##         ANGLEUNIT["degree", 0.0174532925199433]], ID["EPSG",
##         4225]], CONVERSION["UTM zone 25S", METHOD["Transverse
##         Mercator", ID["EPSG", 9807]], PARAMETER["Latitude of
##         natural origin", 0, ANGLEUNIT["degree",
##         0.0174532925199433], ID["EPSG", 8801]],
##         PARAMETER["Longitude of natural origin", -33,
##         ANGLEUNIT["degree", 0.0174532925199433], ID["EPSG",
##         8802]], PARAMETER["Scale factor at natural origin",
##         0.9996, SCALEUNIT["unity", 1], ID["EPSG", 8805]],
##         PARAMETER["False easting", 500000, LENGTHUNIT["metre",
##         1], ID["EPSG", 8806]], PARAMETER["False northing",
##         10000000, LENGTHUNIT["metre", 1], ID["EPSG", 8807]]],
##         CS[Cartesian, 2], AXIS["(E)", east, ORDER[1],
##         LENGTHUNIT["metre", 1]], AXIS["(N)", north, ORDER[2],
##         LENGTHUNIT["metre", 1]], USAGE[SCOPE["unknown"],
##         AREA["Brazil - east of 36°W onshore"], BBOX[-10.1, -36,
##         -4.99, -34.74]], ID["EPSG", 22525]]],
##         TARGETCRS[GEOGCRS["WGS 84", DATUM["World Geodetic
##         System 1984", ELLIPSOID["WGS 84", 6378137,
##         298.257223563, LENGTHUNIT["metre", 1]]],
##         PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
##         0.0174532925199433]], CS[ellipsoidal, 2],
##         AXIS["latitude", north, ORDER[1], ANGLEUNIT["degree",
##         0.0174532925199433]], AXIS["longitude", east, ORDER[2],
##         ANGLEUNIT["degree", 0.0174532925199433]], ID["EPSG",
##         4326]]], ABRIDGEDTRANSFORMATION["Corrego Alegre 1970-72
##         to WGS 84 (3)", VERSION["PBS-Bra 1983"],
##         METHOD["Geocentric translations (geog2D domain)",
##         ID["EPSG", 9603]], PARAMETER["X-axis translation",
##         -205.57, ID["EPSG", 8605]], PARAMETER["Y-axis
##         translation", 168.77, ID["EPSG", 8606]],
##         PARAMETER["Z-axis translation", -4.12, ID["EPSG",
##         8607]], USAGE[SCOPE["Medium and small scale mapping."],
##         AREA["Brazil - Corrego Alegre 1970-1972"], BBOX[-33.78,
##         -58.16, -2.68, -34.74]], ID["EPSG", 6192],
##         REMARK["Formed by concatenation of tfms codes 6191 and
##         1877. Used by Petrobras and ANP until February 2005
##         when replaced by Corrego Alegre 1970-72 to WGS 84 (4)
##         (tfm code 6194)."]]]
## Target:
## BOUNDCRS[SOURCECRS[PROJCRS["SIRGAS 2000 / UTM zone 25S",
##         BASEGEOGCRS["SIRGAS 2000", DATUM["Sistema de Referencia
##         Geocentrico para las AmericaS 2000", ELLIPSOID["GRS
##         1980", 6378137, 298.257222101, LENGTHUNIT["metre",
##         1]]], PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
##         0.0174532925199433]], ID["EPSG", 4674]],
##         CONVERSION["UTM zone 25S", METHOD["Transverse
##         Mercator", ID["EPSG", 9807]], PARAMETER["Latitude of
##         natural origin", 0, ANGLEUNIT["degree",
##         0.0174532925199433], ID["EPSG", 8801]],
##         PARAMETER["Longitude of natural origin", -33,
##         ANGLEUNIT["degree", 0.0174532925199433], ID["EPSG",
##         8802]], PARAMETER["Scale factor at natural origin",
##         0.9996, SCALEUNIT["unity", 1], ID["EPSG", 8805]],
##         PARAMETER["False easting", 500000, LENGTHUNIT["metre",
##         1], ID["EPSG", 8806]], PARAMETER["False northing",
##         10000000, LENGTHUNIT["metre", 1], ID["EPSG", 8807]]],
##         CS[Cartesian, 2], AXIS["(E)", east, ORDER[1],
##         LENGTHUNIT["metre", 1]], AXIS["(N)", north, ORDER[2],
##         LENGTHUNIT["metre", 1]], USAGE[SCOPE["unknown"],
##         AREA["Brazil - 36°W to 30°W"], BBOX[-23.8, -36, 4.19,
##         -29.99]], ID["EPSG", 31985]]], TARGETCRS[GEOGCRS["WGS
##         84", DATUM["World Geodetic System 1984", ELLIPSOID["WGS
##         84", 6378137, 298.257223563, LENGTHUNIT["metre", 1]]],
##         PRIMEM["Greenwich", 0, ANGLEUNIT["degree",
##         0.0174532925199433]], CS[ellipsoidal, 2],
##         AXIS["latitude", north, ORDER[1], ANGLEUNIT["degree",
##         0.0174532925199433]], AXIS["longitude", east, ORDER[2],
##         ANGLEUNIT["degree", 0.0174532925199433]], ID["EPSG",
##         4326]]], ABRIDGEDTRANSFORMATION["SIRGAS 2000 to WGS 84
##         (1)", VERSION["OGP-C&amp;S America"], METHOD["Geocentric
##         translations (geog2D domain)", ID["EPSG", 9603]],
##         PARAMETER["X-axis translation", 0, ID["EPSG", 8605]],
##         PARAMETER["Y-axis translation", 0, ID["EPSG", 8606]],
##         PARAMETER["Z-axis translation", 0, ID["EPSG", 8607]],
##         USAGE[SCOPE["Accuracy 1m."], AREA["Latin America -
##         SIRGAS 2000 by country"], BBOX[-59.87, -122.19, 32.72,
##         -25.28]], ID["EPSG", 15894]]]
## Best instantiable operation has only ballpark accuracy 
## Description: Inverse of UTM zone 25S + Corrego Alegre 1970-72 to WGS 84 (3)
##              + Inverse of SIRGAS 2000 to WGS 84 (1) + UTM zone
##              25S
## Definition:  +proj=pipeline +step +inv +proj=utm +zone=25 +south +ellps=intl
##              +step +proj=push +v_3 +step +proj=cart +ellps=intl
##              +step +proj=helmert +x=-205.57 +y=168.77 +z=-4.12
##              +step +inv +proj=cart +ellps=GRS80 +step +proj=pop
##              +v_3 +step +proj=utm +zone=25 +south +ellps=GRS80</pre></body></html></div>
<p>If we define the look-up terms directly, in this case and unlike that for the OSGB36 datum, we find more operations than when using WKT strings. Now we find one operation with known accuracy (5m), and that a further operation would be possible if a required grid had been present, this grid is not in the PROJ download archive, as no URL is given.</p>
<div class="sourceCode" id="cb105"><html><body><pre class="r">(<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/list_coordOps.html">list_coordOps</a></span>(<span class="st">"EPSG:22525"</span>, <span class="st">"EPSG:31985"</span>))</pre></body></html></div>
<pre><code>## Candidate coordinate operations found:  2 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: EPSG:22525 
## Target: EPSG:31985 
## Best instantiable operation has accuracy: 5 m
## Description: Inverse of UTM zone 25S + Corrego Alegre 1970-72 to SIRGAS 2000
##              (2) + UTM zone 25S
## Definition:  +proj=pipeline +step +inv +proj=utm +zone=25 +south +ellps=intl
##              +step +proj=push +v_3 +step +proj=cart +ellps=intl
##              +step +proj=helmert +x=-206.05 +y=168.28 +z=-3.82
##              +step +inv +proj=cart +ellps=GRS80 +step +proj=pop
##              +v_3 +step +proj=utm +zone=25 +south +ellps=GRS80
## Operation 2 is lacking 1 grid with accuracy 2 m
## Missing grid: CA7072_003.gsb</code></pre>
<div class="sourceCode" id="cb107"><html><body><pre class="r">## Candidate coordinate operations found:  2 
## Strict containment:  FALSE 
## Visualization order:  TRUE 
## Source: EPSG:22525 
## Target: EPSG:31985 
## Best instantiable operation has accuracy: 5 m
## Description: Inverse of UTM zone 25S + Corrego Alegre 1970-72 to SIRGAS 2000
##              (2) + UTM zone 25S
## Definition:  +proj=pipeline +step +inv +proj=utm +zone=25 +south +ellps=intl
##              +step +proj=push +v_3 +step +proj=cart +ellps=intl
##              +step +proj=helmert +x=-206.05 +y=168.28 +z=-3.82
##              +step +inv +proj=cart +ellps=GRS80 +step +proj=pop
##              +v_3 +step +proj=utm +zone=25 +south +ellps=GRS80
## Operation 2 is lacking 1 grid with accuracy 2 m
## Missing grid: CA7072_003.gsb</pre></body></html></div>
<div class="sourceCode" id="cb108"><html><body><pre class="r"><span class="fu"><a href="../reference/list_coordOps.html">best_instantiable_coordOp</a></span>(<span class="no">x</span>)</pre></body></html></div>
<pre><code>## [1] "+proj=pipeline +step +inv +proj=utm +zone=25 +south +ellps=intl +step +proj=push +v_3 +step +proj=cart +ellps=intl +step +proj=helmert +x=-206.05 +y=168.28 +z=-3.82 +step +inv +proj=cart +ellps=GRS80 +step +proj=pop +v_3 +step +proj=utm +zone=25 +south +ellps=GRS80"
## attr(,"description")
## [1] "Inverse of UTM zone 25S + Corrego Alegre 1970-72 to SIRGAS 2000 (2) + UTM zone 25S"</code></pre>
<div class="sourceCode" id="cb110"><html><body><pre class="r">## [1] "+proj=pipeline +step +inv +proj=utm +zone=25 +south +ellps=intl +step
## +proj=push +v_3 +step +proj=cart +ellps=intl +step +proj=helmert +x=-206.05
## +y=168.28 +z=-3.82 +step +inv +proj=cart +ellps=GRS80 +step +proj=pop +v_3 +step
## +proj=utm +zone=25 +south +ellps=GRS80"
## attr(,"description")
## [1] "Inverse of UTM zone 25S + Corrego Alegre 1970-72 to SIRGAS 2000 (2) + 
## UTM zone 25S"</pre></body></html></div>
</div>
<div id="transformations" class="section level2">
<h2 class="hasAnchor">
<a href="#transformations" class="anchor"></a>Transformations</h2>
<p>The problem raised by the modernisation of PROJ can be encapsulated in this example of Scotland (once again the commented out runs are from a PROJ62/GDAL30 platform, the live runs from the platform building the vignette):</p>
<div class="sourceCode" id="cb111"><html><body><pre class="r"><span class="no">scot_BNG</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/readOGR.html">readOGR</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"vectors"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"rgdal"</span>), <span class="st">"scot_BNG"</span>)</pre></body></html></div>
<pre><code>## Warning in OGRSpatialRef(dsn, layer, morphFromESRI = morphFromESRI, dumpSRS =
## dumpSRS, : Discarded datum OSGB_1936 in CRS definition: +proj=tmerc +lat_0=49
## +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs</code></pre>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: "/tmp/RtmpEreEhT/temp_libpath193a751bafe22a/rgdal/vectors", layer: "scot_BNG"
## with 56 features
## It has 13 fields</code></pre>
<div class="sourceCode" id="cb114"><html><body><pre class="r">## Warning in OGRSpatialRef(dsn, layer, morphFromESRI = morphFromESRI, dumpSRS =
## dumpSRS): Discarded datum OSGB_1936 in CRS definition: +proj=tmerc +lat_0=49
## +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs
## OGR data source with driver: ESRI Shapefile 
## Source: "/home/rsb/lib/r_libs/rgdal/vectors", layer: "scot_BNG"
## with 56 features
## It has 13 fields
## Warning in OGRSpatialRef(dsn = dsn, layer = layer, morphFromESRI =
## morphFromESRI, : Discarded datum OSGB_1936 in CRS definition: +proj=tmerc
## +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy
## +units=m +no_defs
## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
## datum Unknown_based_on_Airy_1830_ellipsoid in CRS definition</pre></body></html></div>
<p>On reading with PROJ6/GDAL3, we discard the <code>+datum</code> tag, so losing information and ending up with a bounding box with positional accuracy degraded to an unknown extent, using the pre-PROJ6 adaptation CRS representation:</p>
<div class="sourceCode" id="cb115"><html><body><pre class="r">(<span class="no">load_status</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">get_transform_wkt_comment</a></span>())</pre></body></html></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb117"><html><body><pre class="r">## [1] TRUE</pre></body></html></div>
<p>(Again, commented output blocks are run on a PROJ6/GDAL3 platform). This demonstration was impacted by PROJ 6.3.0 fragility, with the <code>+ellps=</code> tag vanishing (with the <code>+units=</code> tag) apparently arbitrarily. A tentative diagnosis is that the datum node of the OGRSpatialReference object becomes unavailable, although why some change in PROJ leads to this aberation is unknown.</p>
<div class="sourceCode" id="cb118"><html><body><pre class="r"><span class="fu"><a href="../reference/spTransform-methods.html">set_transform_wkt_comment</a></span>(<span class="fl">FALSE</span>)
<span class="no">scot_LL</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">scot_BNG</span>, <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+proj=longlat +datum=WGS84"</span>))
(<span class="no">b0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/bbox.html">bbox</a></span>(<span class="no">scot_LL</span>))</pre></body></html></div>
<pre><code>##         min       max
## x -8.621387 -0.753056
## y 54.626555 60.843843</code></pre>
<div class="sourceCode" id="cb120"><html><body><pre class="r">##         min       max
## x -8.621387 -0.753056
## y 54.626555 60.843843</pre></body></html></div>
<p>We might fake the PROJ string by extracting the <code>"CRS"</code> object:</p>
<div class="sourceCode" id="cb121"><html><body><pre class="r">(<span class="no">crs</span> <span class="kw">&lt;-</span> <span class="fu">slot</span>(<span class="no">scot_BNG</span>, <span class="st">"proj4string"</span>))</pre></body></html></div>
<pre><code>## CRS arguments:
##  +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
## +y_0=-100000 +ellps=airy +units=m +no_defs</code></pre>
<div class="sourceCode" id="cb123"><html><body><pre class="r">## CRS arguments:
##  +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
## +y_0=-100000 +ellps=airy +units=m +no_defs</pre></body></html></div>
<div class="sourceCode" id="cb124"><html><body><pre class="r"><span class="fu">slot</span>(<span class="no">crs</span>, <span class="st">"projargs"</span>)</pre></body></html></div>
<pre><code>## [1] "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs"</code></pre>
<div class="sourceCode" id="cb126"><html><body><pre class="r">## [1] "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000
## +ellps=airy +units=m +no_defs"</pre></body></html></div>
<p>and updating the PROJ string in-place if we know a sensible incantation:</p>
<div class="sourceCode" id="cb127"><html><body><pre class="r"><span class="fu">slot</span>(<span class="no">crs</span>, <span class="st">"projargs"</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu">slot</span>(<span class="no">crs</span>, <span class="st">"projargs"</span>), <span class="st">" +datum=OSGB36"</span>)
<span class="fu">slot</span>(<span class="no">scot_BNG</span>, <span class="st">"proj4string"</span>) <span class="kw">&lt;-</span> <span class="no">crs</span>
<span class="no">scot_LL1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">scot_BNG</span>, <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+proj=longlat +datum=WGS84"</span>))
(<span class="no">b1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/bbox.html">bbox</a></span>(<span class="no">scot_LL1</span>))</pre></body></html></div>
<pre><code>##         min        max
## x -8.622158 -0.7550709
## y 54.626633 60.8432318</code></pre>
<div class="sourceCode" id="cb129"><html><body><pre class="r">##         min       max
## x -8.622158 -0.755071
## y 54.626633 60.843232</pre></body></html></div>
<p>The two bounding boxes differ a good deal:</p>
<div class="sourceCode" id="cb130"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">b0</span>, <span class="no">b1</span>, <span class="kw">scale</span><span class="kw">=</span><span class="fl">1</span>)</pre></body></html></div>
<pre><code>## [1] "Mean absolute difference: 0.0008689015"</code></pre>
<div class="sourceCode" id="cb132"><html><body><pre class="r">## [1] "Mean absolute difference: 0.0008689328"</pre></body></html></div>
<p>The SW corner of Scotland differs by about 50m, the NE corner by almost 130m:</p>
<div class="sourceCode" id="cb133"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sp/man/spDistsN1.html">spDists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">b0</span>), <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">b1</span>), <span class="kw">longlat</span><span class="kw">=</span><span class="fl">TRUE</span>))*<span class="fl">1000</span></pre></body></html></div>
<pre><code>## [1]  50.56342 128.98675</code></pre>
<div class="sourceCode" id="cb135"><html><body><pre class="r">## [1]  50.56708 128.99003</pre></body></html></div>
<p>Re-instating the use of WKT comments lets us use the transformation path which instantiates the coordinate operation from the WKT strings in the <code>"CRS"</code> object comments:</p>
<div class="sourceCode" id="cb136"><html><body><pre class="r"><span class="fu"><a href="../reference/spTransform-methods.html">set_transform_wkt_comment</a></span>(<span class="no">load_status</span>)</pre></body></html></div>
<div class="sourceCode" id="cb137"><html><body><pre class="r"><span class="no">scot_BNG</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/readOGR.html">readOGR</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"vectors"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"rgdal"</span>), <span class="st">"scot_BNG"</span>)</pre></body></html></div>
<pre><code>## Warning in OGRSpatialRef(dsn, layer, morphFromESRI = morphFromESRI, dumpSRS =
## dumpSRS, : Discarded datum OSGB_1936 in CRS definition: +proj=tmerc +lat_0=49
## +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs</code></pre>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: "/tmp/RtmpEreEhT/temp_libpath193a751bafe22a/rgdal/vectors", layer: "scot_BNG"
## with 56 features
## It has 13 fields</code></pre>
<div class="sourceCode" id="cb140"><html><body><pre class="r">## Warning in OGRSpatialRef(dsn, layer, morphFromESRI = morphFromESRI, dumpSRS =
## dumpSRS): Discarded datum OSGB_1936 in CRS definition: +proj=tmerc +lat_0=49
## +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs
## OGR data source with driver: ESRI Shapefile 
## Source: "/home/rsb/lib/r_libs/rgdal/vectors", layer: "scot_BNG"
## with 56 features
## It has 13 fields
## Warning in OGRSpatialRef(dsn = dsn, layer = layer, morphFromESRI =
## morphFromESRI, : Discarded datum OSGB_1936 in CRS definition: +proj=tmerc
## +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy
## +units=m +no_defs
## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
## datum Unknown_based_on_Airy_1830_ellipsoid in CRS definition</pre></body></html></div>
<p>In <strong>rgdal</strong> 1.5-2, the coordinate operation lookup is done once for the first matrix of coordinates, and passed then on to subsequent transformations:</p>
<div class="sourceCode" id="cb141"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="no">scot_LL2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">scot_BNG</span>, <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+proj=longlat +datum=WGS84"</span>)))</pre></body></html></div>
<pre><code>##    user  system elapsed 
##   0.095   0.005   0.101</code></pre>
<div class="sourceCode" id="cb143"><html><body><pre class="r">##    user  system elapsed 
##   0.095   0.000   0.096</pre></body></html></div>
<p>Timings for <strong>rgdal</strong> 1.5-1, when look-up was repeated for each matrix of coordinates:</p>
<div class="sourceCode" id="cb144"><html><body><pre class="r">##    user  system elapsed 
##   3.431   0.037   3.546</pre></body></html></div>
<div class="sourceCode" id="cb145"><html><body><pre class="r">(<span class="no">b2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/bbox.html">bbox</a></span>(<span class="no">scot_LL2</span>))</pre></body></html></div>
<pre><code>##         min        max
## x -8.622158 -0.7550709
## y 54.626633 60.8432318</code></pre>
<div class="sourceCode" id="cb147"><html><body><pre class="r">##         min        max
## x -8.622158 -0.7550709
## y 54.626633 60.8432318</pre></body></html></div>
<div class="sourceCode" id="cb148"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">b1</span>, <span class="no">b2</span>, <span class="kw">scale</span><span class="kw">=</span><span class="fl">1</span>)</pre></body></html></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb150"><html><body><pre class="r">## [1] "Mean absolute difference: 3.361822e-08"</pre></body></html></div>
<p>The coordinate operation last used may be retrieved with (default empty):</p>
<div class="sourceCode" id="cb151"><html><body><pre class="r"><span class="fu"><a href="../reference/spTransform-methods.html">get_last_coordOp</a></span>()</pre></body></html></div>
<pre><code>## [1] "+proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +step +proj=push +v_3 +step +proj=cart +ellps=airy +step +proj=helmert +x=446.448 +y=-125.157 +z=542.06 +rx=0.15 +ry=0.247 +rz=0.842 +s=-20.489 +convention=position_vector +step +inv +proj=cart +ellps=WGS84 +step +proj=pop +v_3 +step +proj=unitconvert +xy_in=rad +xy_out=deg"</code></pre>
<div class="sourceCode" id="cb153"><html><body><pre class="r">## [1] "+proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717
## +x_0=400000 +y_0=-100000 +ellps=airy +step +proj=push +v_3 +step +proj=cart
## +ellps=airy +step +proj=helmert +x=446.448 +y=-125.157 +z=542.06 +rx=0.15 +ry=0.247
## +rz=0.842 +s=-20.489 +convention=position_vector +step +inv +proj=cart +ellps=WGS84
## +step +proj=pop +v_3 +step +proj=unitconvert +xy_in=rad +xy_out=deg"</pre></body></html></div>
<p>If a given coordinate operation needs to be repeated, a good deal of time can be saved, as searches for coordinate operations take place once for <code>"SpatialPoints"</code> objects, but for <code>"SpatialLines"</code> and <code>"SpatialPolygons"</code> objects once for each "<code>Line"</code> or <code>"Polygon"</code> object:</p>
<div class="sourceCode" id="cb154"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="no">scot_LL3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">scot_BNG</span>, <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+proj=longlat +datum=WGS84"</span>),
                                    <span class="kw">coordOp</span><span class="kw">=</span><span class="fu"><a href="../reference/spTransform-methods.html">get_last_coordOp</a></span>()))</pre></body></html></div>
<pre><code>##    user  system elapsed 
##   0.067   0.000   0.069</code></pre>
<div class="sourceCode" id="cb156"><html><body><pre class="r">##    user  system elapsed 
##   0.066   0.002   0.070</pre></body></html></div>
<div class="sourceCode" id="cb157"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">b2</span>, <span class="fu"><a href="https://rdrr.io/pkg/sp/man/bbox.html">bbox</a></span>(<span class="no">scot_LL3</span>), <span class="kw">scale</span><span class="kw">=</span><span class="fl">1</span>)</pre></body></html></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb159"><html><body><pre class="r">## [1] TRUE</pre></body></html></div>
<p>The possibility of speeding up frequently used coordinate operations shows how listing candidate coordinate operations from a direct search lets us use functions from the previous section:</p>
<div class="sourceCode" id="cb160"><html><body><pre class="r"><span class="no">wkt_source_datum</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="fu">slot</span>(<span class="no">scot_BNG</span>, <span class="st">"proj4string"</span>))
<span class="no">wkt_target_datum</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+proj=longlat +datum=WGS84"</span>))
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/list_coordOps.html">list_coordOps</a></span>(<span class="no">wkt_source_datum</span>, <span class="no">wkt_target_datum</span>)
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="no">scot_LL4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">scot_BNG</span>, <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+proj=longlat +datum=WGS84"</span>),
                                    <span class="kw">coordOp</span><span class="kw">=</span><span class="fu"><a href="../reference/list_coordOps.html">best_instantiable_coordOp</a></span>(<span class="no">x</span>)))</pre></body></html></div>
<pre><code>##    user  system elapsed 
##   0.067   0.000   0.069</code></pre>
<div class="sourceCode" id="cb162"><html><body><pre class="r">##    user  system elapsed 
##   0.066   0.002   0.069</pre></body></html></div>
<div class="sourceCode" id="cb163"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">b2</span>, <span class="fu"><a href="https://rdrr.io/pkg/sp/man/bbox.html">bbox</a></span>(<span class="no">scot_LL4</span>), <span class="kw">scale</span><span class="kw">=</span><span class="fl">1</span>)</pre></body></html></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb165"><html><body><pre class="r">## [1] TRUE</pre></body></html></div>
</div>
<div id="axis-swapping" class="section level2">
<h2 class="hasAnchor">
<a href="#axis-swapping" class="anchor"></a>Axis swapping</h2>
<p>Luigi Ranghetti and Lorenzo Busetto provided <a href="http://rpubs.com/ranghetti/sptransform-issue">input</a> with regard to axis swapping in <strong>rgdal</strong>. The task is to provide round-trip coordinate identity for four CRS. Here, we use just <strong>sp</strong>/<strong>rgdal</strong> to create the input objects:</p>
<div class="sourceCode" id="cb166"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rgdal</span>)</pre></body></html></div>
<div class="sourceCode" id="cb167"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span>(<span class="st">"rgdal"</span>)</pre></body></html></div>
<pre><code>## [1] '1.5.10'</code></pre>
<div class="sourceCode" id="cb169"><html><body><pre class="r"><span class="fu"><a href="../reference/GDALDriver-class.html">rgdal_extSoftVersion</a></span>()</pre></body></html></div>
<pre><code>##           GDAL GDAL_with_GEOS           PROJ             sp 
##        "3.1.0"         "TRUE"        "7.0.1"        "1.4-2"</code></pre>
<div class="sourceCode" id="cb171"><html><body><pre class="r"><span class="no">pt0_lonlat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPoints</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>,<span class="fl">46</span>), <span class="kw">nrow</span><span class="kw">=</span><span class="fl">1</span>), <span class="kw">proj4string</span><span class="kw">=</span> <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+init=epsg:4326"</span>))
<span class="no">pt0_laea89</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">pt0_lonlat</span>, <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+init=epsg:3035"</span>))</pre></body></html></div>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
## datum European_Terrestrial_Reference_System_1989 in CRS definition</code></pre>
<div class="sourceCode" id="cb173"><html><body><pre class="r"><span class="no">pt0_wgs32n</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">pt0_lonlat</span>, <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+init=epsg:32632"</span>))
<span class="no">pt0_psmerc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">pt0_lonlat</span>, <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+init=epsg:3857"</span>))</pre></body></html></div>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
## ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
## +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
## datum WGS_1984 in CRS definition</code></pre>
<div class="sourceCode" id="cb176"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">pt0_lonlat</span>)</pre></body></html></div>
<pre><code>##      coords.x1 coords.x2
## [1,]        10        46</code></pre>
<div class="sourceCode" id="cb178"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">pt0_laea89</span>)</pre></body></html></div>
<pre><code>##      coords.x1 coords.x2
## [1,]   4321000   2543009</code></pre>
<div class="sourceCode" id="cb180"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">pt0_wgs32n</span>)</pre></body></html></div>
<pre><code>##      coords.x1 coords.x2
## [1,]  577432.2   5094534</code></pre>
<div class="sourceCode" id="cb182"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">pt0_psmerc</span>)</pre></body></html></div>
<pre><code>##      coords.x1 coords.x2
## [1,]   1113195   5780349</code></pre>
<p>We put the input (source) objects into a list:</p>
<div class="sourceCode" id="cb184"><html><body><pre class="r"><span class="no">from</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">pt0_lonlat</span><span class="kw">=</span><span class="no">pt0_lonlat</span>, <span class="kw">pt0_psmerc</span><span class="kw">=</span><span class="no">pt0_psmerc</span>, <span class="kw">pt0_wgs32n</span><span class="kw">=</span><span class="no">pt0_wgs32n</span>, <span class="kw">pt0_laea89</span><span class="kw">=</span><span class="no">pt0_laea89</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">from</span>)</pre></body></html></div>
<pre><code>## [1] "pt0_lonlat" "pt0_psmerc" "pt0_wgs32n" "pt0_laea89"</code></pre>
<div class="sourceCode" id="cb186"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">from</span>, <span class="no">proj4string</span>)</pre></body></html></div>
<pre><code>## Warning in FUN(X[[i]], ...): CRS object has comment, which is lost in output

## Warning in FUN(X[[i]], ...): CRS object has comment, which is lost in output

## Warning in FUN(X[[i]], ...): CRS object has comment, which is lost in output

## Warning in FUN(X[[i]], ...): CRS object has comment, which is lost in output</code></pre>
<pre><code>##                                                                                                         pt0_lonlat 
##                                                                              "+proj=longlat +datum=WGS84 +no_defs" 
##                                                                                                         pt0_psmerc 
## "+proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs" 
##                                                                                                         pt0_wgs32n 
##                                                                "+proj=utm +zone=32 +datum=WGS84 +units=m +no_defs" 
##                                                                                                         pt0_laea89 
##                          "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs"</code></pre>
<p>and the target EPSG codes into a vector:</p>
<div class="sourceCode" id="cb189"><html><body><pre class="r"><span class="no">to</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"4326"</span>, <span class="st">"3857"</span>, <span class="st">"32632"</span>, <span class="st">"3035"</span>)</pre></body></html></div>
<p>From SVN revision 903, a global <strong>rgdal</strong> option can be set to enforce visualization order in <code><a href="../reference/spTransform-methods.html">spTransform()</a></code> methods (the default value when the package is loaded is <code>TRUE</code>) when no <code>coordOp=</code> argument is given, and the coordinate operation has to be found automatically:</p>
<div class="sourceCode" id="cb190"><html><body><pre class="r"><span class="fu"><a href="../reference/spTransform-methods.html">get_enforce_xy</a></span>()</pre></body></html></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb192"><html><body><pre class="r"><span class="fu"><a href="../reference/spTransform-methods.html">set_enforce_xy</a></span>(<span class="fl">FALSE</span>)
<span class="fu"><a href="../reference/spTransform-methods.html">get_enforce_xy</a></span>()</pre></body></html></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb194"><html><body><pre class="r"><span class="no">run</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>
<span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span>(<span class="st">"sp"</span>) <span class="kw">&lt;</span> <span class="st">"1.3.3"</span>) <span class="no">run</span> <span class="kw">&lt;-</span> <span class="fl">FALSE</span>
<span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span>(<span class="st">"rgdal"</span>) <span class="kw">&lt;</span> <span class="st">"1.5.3"</span>) <span class="no">run</span> <span class="kw">&lt;-</span> <span class="fl">FALSE</span>
<span class="kw">if</span> (<span class="no">run</span> <span class="kw">&amp;&amp;</span> !<span class="kw pkg">rgdal</span><span class="kw ns">::</span><span class="fu"><a href="../reference/projInfo.html">new_proj_and_gdal</a></span>()) <span class="no">run</span> <span class="kw">&lt;-</span> <span class="fl">FALSE</span></pre></body></html></div>
<p>Setting it to false gives failing round-trips for two of the four CRS:</p>
<div class="sourceCode" id="cb195"><html><body><pre class="r"><span class="no">out_EPSG_non_viz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span>(<span class="fl">NA</span>), <span class="kw">nrow</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">ncol</span><span class="kw">=</span><span class="fl">4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">out_EPSG_non_viz</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">from</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">out_EPSG_non_viz</span>) <span class="kw">&lt;-</span> <span class="no">to</span>
<span class="kw">for</span> (<span class="no">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">from</span>)) {
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">to</span>)) {
    <span class="no">pt1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">j</span>]], <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="kw">SRS_string</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"EPSG:"</span>, <span class="no">to</span>[<span class="no">i</span>])))
    <span class="no">out_EPSG_non_viz</span>[<span class="no">i</span>, <span class="no">j</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">i</span>]]),
      <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">pt1</span>)))
  }
}
<span class="no">out_EPSG_non_viz</span></pre></body></html></div>
<pre><code>##       pt0_lonlat pt0_psmerc pt0_wgs32n pt0_laea89
## 4326        TRUE       TRUE       TRUE       TRUE
## 3857        TRUE       TRUE       TRUE       TRUE
## 32632       TRUE       TRUE       TRUE       TRUE
## 3035        TRUE       TRUE       TRUE       TRUE</code></pre>
<p>Resetting to the default (<code>TRUE</code>) value gives round-trip success:</p>
<div class="sourceCode" id="cb197"><html><body><pre class="r"><span class="fu"><a href="../reference/spTransform-methods.html">set_enforce_xy</a></span>(<span class="fl">TRUE</span>)
<span class="fu"><a href="../reference/spTransform-methods.html">get_enforce_xy</a></span>()</pre></body></html></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb199"><html><body><pre class="r"><span class="no">out_EPSG</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span>(<span class="fl">NA</span>), <span class="kw">nrow</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">ncol</span><span class="kw">=</span><span class="fl">4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">out_EPSG</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">from</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">out_EPSG</span>) <span class="kw">&lt;-</span> <span class="no">to</span>
<span class="kw">for</span> (<span class="no">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">from</span>)) {
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">to</span>)) {
    <span class="no">pt1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">j</span>]], <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="kw">SRS_string</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"EPSG:"</span>, <span class="no">to</span>[<span class="no">i</span>])))
    <span class="no">out_EPSG</span>[<span class="no">i</span>, <span class="no">j</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">i</span>]]),
      <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">pt1</span>)))
  }
}
<span class="no">out_EPSG</span></pre></body></html></div>
<pre><code>##       pt0_lonlat pt0_psmerc pt0_wgs32n pt0_laea89
## 4326        TRUE       TRUE       TRUE       TRUE
## 3857        TRUE       TRUE       TRUE       TRUE
## 32632       TRUE       TRUE       TRUE       TRUE
## 3035        TRUE       TRUE       TRUE       TRUE</code></pre>
<p>If we instantiate the target CRS simply using a PROJ string with <code>+init=</code> rather than using the <code><a href="../reference/CRS-class.html">CRS()</a></code> <code>SRS_string=</code> argument, it appears that visualization order is chosen anyway, whatever the status of <code>enforce_xy</code>:</p>
<div class="sourceCode" id="cb201"><html><body><pre class="r"><span class="fu"><a href="../reference/spTransform-methods.html">get_enforce_xy</a></span>()</pre></body></html></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb203"><html><body><pre class="r"><span class="fu"><a href="../reference/spTransform-methods.html">set_enforce_xy</a></span>(<span class="fl">FALSE</span>)
<span class="fu"><a href="../reference/spTransform-methods.html">get_enforce_xy</a></span>()</pre></body></html></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb205"><html><body><pre class="r"><span class="no">out_init_non_viz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span>(<span class="fl">NA</span>), <span class="kw">nrow</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">ncol</span><span class="kw">=</span><span class="fl">4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">out_init_non_viz</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">from</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">out_init_non_viz</span>) <span class="kw">&lt;-</span> <span class="no">to</span>
<span class="kw">for</span> (<span class="no">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">from</span>)) {
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">to</span>)) {
    <span class="no">pt1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">j</span>]], <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"+init=epsg:"</span>, <span class="no">to</span>[<span class="no">i</span>])))
    <span class="no">out_init_non_viz</span>[<span class="no">i</span>, <span class="no">j</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">i</span>]]),
      <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">pt1</span>)))
  }
}
<span class="no">out_init_non_viz</span></pre></body></html></div>
<pre><code>##       pt0_lonlat pt0_psmerc pt0_wgs32n pt0_laea89
## 4326        TRUE       TRUE       TRUE       TRUE
## 3857        TRUE       TRUE       TRUE       TRUE
## 32632       TRUE       TRUE       TRUE       TRUE
## 3035        TRUE       TRUE       TRUE       TRUE</code></pre>
<div class="sourceCode" id="cb207"><html><body><pre class="r"><span class="fu"><a href="../reference/spTransform-methods.html">set_enforce_xy</a></span>(<span class="fl">TRUE</span>)
<span class="fu"><a href="../reference/spTransform-methods.html">get_enforce_xy</a></span>()</pre></body></html></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb209"><html><body><pre class="r"><span class="no">out_init</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span>(<span class="fl">NA</span>), <span class="kw">nrow</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">ncol</span><span class="kw">=</span><span class="fl">4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">out_init</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">from</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">out_init</span>) <span class="kw">&lt;-</span> <span class="no">to</span>
<span class="kw">for</span> (<span class="no">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">from</span>)) {
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">to</span>)) {
    <span class="no">pt1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">j</span>]], <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"+init=epsg:"</span>, <span class="no">to</span>[<span class="no">i</span>])))
    <span class="no">out_init</span>[<span class="no">i</span>, <span class="no">j</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">i</span>]]),
      <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">pt1</span>)))
  }
}
<span class="no">out_init</span></pre></body></html></div>
<pre><code>##       pt0_lonlat pt0_psmerc pt0_wgs32n pt0_laea89
## 4326        TRUE       TRUE       TRUE       TRUE
## 3857        TRUE       TRUE       TRUE       TRUE
## 32632       TRUE       TRUE       TRUE       TRUE
## 3035        TRUE       TRUE       TRUE       TRUE</code></pre>
<p>Finally, by listing candidate coordinate operations first, and choosing the best one, use can be made of the <code><a href="../reference/list_coordOps.html">list_coordOps()</a></code> <code>visualization_order=</code> argument, with default value <code>TRUE</code>; here it is given explicitly. This gives round trip success:</p>
<div class="sourceCode" id="cb211"><html><body><pre class="r"><span class="no">out_EPSG</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span>(<span class="fl">NA</span>), <span class="kw">nrow</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">ncol</span><span class="kw">=</span><span class="fl">4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">out_EPSG</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">from</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">out_EPSG</span>) <span class="kw">&lt;-</span> <span class="no">to</span>
<span class="kw">for</span> (<span class="no">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">from</span>)) {
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">to</span>)) {
    <span class="no">coo1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/list_coordOps.html">list_coordOps</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="fu">slot</span>(<span class="no">from</span><span class="kw">[[</span><span class="no">j</span>]], <span class="st">"proj4string"</span>)),
                          <span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="kw">SRS_string</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"EPSG:"</span>, <span class="no">to</span>[<span class="no">i</span>]))),
                          <span class="kw">visualization_order</span><span class="kw">=</span><span class="fl">TRUE</span>)
    <span class="no">pt1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">j</span>]], <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="kw">SRS_string</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"EPSG:"</span>, <span class="no">to</span>[<span class="no">i</span>])),
      <span class="kw">coordOp</span><span class="kw">=</span><span class="fu"><a href="../reference/list_coordOps.html">best_instantiable_coordOp</a></span>(<span class="no">coo1</span>))
    <span class="no">out_EPSG</span>[<span class="no">i</span>, <span class="no">j</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">i</span>]]),
      <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">pt1</span>)))
  }
}
<span class="no">out_EPSG</span></pre></body></html></div>
<pre><code>##       pt0_lonlat pt0_psmerc pt0_wgs32n pt0_laea89
## 4326        TRUE       TRUE       TRUE       TRUE
## 3857        TRUE       TRUE       TRUE       TRUE
## 32632       TRUE       TRUE       TRUE       TRUE
## 3035        TRUE       TRUE       TRUE       TRUE</code></pre>
<p>The setting of the <code><a href="../reference/list_coordOps.html">list_coordOps()</a></code> <code>visualization_order=</code> argument overrides the global option value (as would setting <code>enforce_xy=</code> in calls to <code><a href="../reference/spTransform-methods.html">spTransform()</a></code>):</p>
<div class="sourceCode" id="cb213"><html><body><pre class="r"><span class="no">out_EPSG_non_viz1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span>(<span class="fl">NA</span>), <span class="kw">nrow</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">ncol</span><span class="kw">=</span><span class="fl">4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">out_EPSG_non_viz1</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">from</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">out_EPSG_non_viz1</span>) <span class="kw">&lt;-</span> <span class="no">to</span>
<span class="kw">for</span> (<span class="no">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">from</span>)) {
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">to</span>)) {
    <span class="no">coo1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/list_coordOps.html">list_coordOps</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="fu">slot</span>(<span class="no">from</span><span class="kw">[[</span><span class="no">j</span>]], <span class="st">"proj4string"</span>)),
                          <span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="kw">SRS_string</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"EPSG:"</span>, <span class="no">to</span>[<span class="no">i</span>]))),
                          <span class="kw">visualization_order</span><span class="kw">=</span><span class="fl">FALSE</span>)
    <span class="no">pt1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">j</span>]], <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="kw">SRS_string</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"EPSG:"</span>, <span class="no">to</span>[<span class="no">i</span>])),
      <span class="kw">coordOp</span><span class="kw">=</span><span class="fu"><a href="../reference/list_coordOps.html">best_instantiable_coordOp</a></span>(<span class="no">coo1</span>))
    <span class="no">out_EPSG_non_viz1</span>[<span class="no">i</span>, <span class="no">j</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">i</span>]]),
      <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">pt1</span>)))
  }
}
<span class="no">out_EPSG_non_viz1</span></pre></body></html></div>
<pre><code>##       pt0_lonlat pt0_psmerc pt0_wgs32n pt0_laea89
## 4326        TRUE       TRUE       TRUE       TRUE
## 3857        TRUE       TRUE       TRUE       TRUE
## 32632       TRUE       TRUE       TRUE       TRUE
## 3035        TRUE       TRUE       TRUE       TRUE</code></pre>
<div class="sourceCode" id="cb215"><html><body><pre class="r"><span class="no">out_EPSG_non_viz2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span>(<span class="fl">NA</span>), <span class="kw">nrow</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">ncol</span><span class="kw">=</span><span class="fl">4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">out_EPSG_non_viz2</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">from</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">out_EPSG_non_viz2</span>) <span class="kw">&lt;-</span> <span class="no">to</span>
<span class="kw">for</span> (<span class="no">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">from</span>)) {
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span><span class="kw">=</span><span class="no">to</span>)) {
    <span class="no">pt1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/spTransform-methods.html">spTransform</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">j</span>]], <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="kw">SRS_string</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"EPSG:"</span>, <span class="no">to</span>[<span class="no">i</span>])),
      <span class="kw">enforce_xy</span><span class="kw">=</span><span class="fl">FALSE</span>)
    <span class="no">out_EPSG_non_viz2</span>[<span class="no">i</span>, <span class="no">j</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">from</span><span class="kw">[[</span><span class="no">i</span>]]),
      <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">pt1</span>)))
  }
}
<span class="no">out_EPSG_non_viz2</span></pre></body></html></div>
<pre><code>##       pt0_lonlat pt0_psmerc pt0_wgs32n pt0_laea89
## 4326        TRUE       TRUE       TRUE       TRUE
## 3857        TRUE       TRUE       TRUE       TRUE
## 32632       TRUE       TRUE       TRUE       TRUE
## 3035        TRUE       TRUE       TRUE       TRUE</code></pre>
</div>
<div id="adapting-project-for-proj-6" class="section level2">
<h2 class="hasAnchor">
<a href="#adapting-project-for-proj-6" class="anchor"></a>Adapting <code>project()</code> for PROJ 6+</h2>
<p>It was originally intended to retire <code><a href="../reference/project.html">project()</a></code>, because of the need to focus on <code><a href="../reference/spTransform-methods.html">spTransform()</a></code>. Because it turned out that more packages than anticipated use <code><a href="../reference/project.html">project()</a></code>, it has been adapted for the new setting. The declared projection will be accepted as a PROJ string, a WKT2 string, or similar, and new PROJ functions are used first to extract the geographical CRS from the given projected CRS, and a transformation found either forward from geographical to projected or inverse from projected to geographical. It now uses <code>proj_trans()</code> internally to convert single coordinates, so permitting the handling of out-of-domain coordinates. Note that no adaptation has been made for <code>legacy=FALSE</code> because as yet no Windows 32-bit build of PROJ or GDAL have been tried - <code>legacy=FALSE</code> uses the pre-PROJ6 compiled function <code><a href="https://rdrr.io/r/base/transform.html">transform()</a></code>. The <code>verbose=</code> argument shows the chosen transformation pipeline:</p>
<div class="sourceCode" id="cb217"><html><body><pre class="r"><span class="no">ll</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">12.1823368669203</span>, <span class="fl">11.9149630062421</span>, <span class="fl">12.3186076188739</span>,
<span class="fl">12.6207597184845</span>, <span class="fl">12.9955172054652</span>, <span class="fl">12.6316117692658</span>, <span class="fl">12.4680041846297</span>,
<span class="fl">12.4366882666609</span>, <span class="fl">NA</span>, <span class="fl">NA</span>, -<span class="fl">5.78993051516384</span>, -<span class="fl">5.03798674888479</span>,
-<span class="fl">4.60623015708619</span>, -<span class="fl">4.43802336997614</span>, -<span class="fl">4.78110320396188</span>, -<span class="fl">4.99127125409291</span>,
-<span class="fl">5.24836150474498</span>, -<span class="fl">5.68430388755925</span>, <span class="fl">NA</span>, <span class="fl">NA</span>), <span class="kw">.Dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10L</span>,
<span class="fl">2L</span>), <span class="kw">.Dimnames</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>)))
<span class="fu"><a href="https://rdrr.io/r/base/try.html">try</a></span>(<span class="no">xy0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span>(<span class="no">ll</span>, <span class="st">"+proj=moll"</span>, <span class="kw">legacy</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">verbose</span><span class="kw">=</span><span class="fl">TRUE</span>))</pre></body></html></div>
<pre><code>## proj=pipeline step proj=unitconvert xy_in=deg xy_out=rad step proj=moll
## lon_0=0 x_0=0 y_0=0 ellps=WGS84</code></pre>
<div class="sourceCode" id="cb219"><html><body><pre class="r"><span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span>(<span class="st">"xy0"</span>)) <span class="no">xy0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1217100.8468177</span>, <span class="fl">1191302.229156</span>,
<span class="fl">1232143.28841193</span>, <span class="fl">1262546.27733232</span>, <span class="fl">1299648.82357849</span>, <span class="fl">1263011.18154638</span>,
<span class="fl">1246343.17808186</span>, <span class="fl">1242654.33986052</span>, <span class="fl">NA</span>, <span class="fl">NA</span>, -<span class="fl">715428.207551599</span>,
-<span class="fl">622613.577983058</span>, -<span class="fl">569301.605757784</span>, -<span class="fl">548528.530156422</span>, -<span class="fl">590895.949857199</span>,
-<span class="fl">616845.926397351</span>, -<span class="fl">648585.161643274</span>, -<span class="fl">702393.1160979</span>, <span class="fl">NA</span>, <span class="fl">NA</span>),
<span class="kw">.Dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10L</span>, <span class="fl">2L</span>), <span class="kw">.Dimnames</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>)))
<span class="fu"><a href="https://rdrr.io/r/base/try.html">try</a></span>(<span class="no">ll0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span>(<span class="no">xy0</span>, <span class="st">"+proj=moll"</span>, <span class="kw">inv</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">legacy</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">verbose</span><span class="kw">=</span><span class="fl">TRUE</span>))</pre></body></html></div>
<pre><code>## proj=pipeline step inv proj=moll lon_0=0 x_0=0 y_0=0 ellps=WGS84 step
## proj=unitconvert xy_in=rad xy_out=deg</code></pre>
<div class="sourceCode" id="cb221"><html><body><pre class="r"><span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span>(<span class="st">"ll0"</span>)) <span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">ll</span>, <span class="no">ll0</span>)</pre></body></html></div>
<pre><code>## [1] TRUE</code></pre>
<p>It is possible to use the <code>coordOp=</code> argument to pass through a known transformation pipeline:</p>
<div class="sourceCode" id="cb223"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/try.html">try</a></span>(<span class="no">xy1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span>(<span class="no">ll</span>, <span class="st">"+proj=moll"</span>, <span class="kw">legacy</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">coordOp</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"+proj=pipeline +step"</span>,
<span class="st">"+proj=unitconvert +xy_in=deg +xy_out=rad +step +proj=moll +lon_0=0 +x_0=0 +y_0=0 ellps=WGS84"</span>)))
<span class="fu"><a href="https://rdrr.io/r/base/try.html">try</a></span>(<span class="no">ll1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span>(<span class="no">xy1</span>, <span class="st">"+proj=moll"</span>, <span class="kw">inv</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">legacy</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">coordOp</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"+proj=pipeline +step"</span>,
<span class="st">"+inv +proj=moll +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +step +proj=unitconvert +xy_in=rad +xy_out=deg"</span>)))
<span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span>(<span class="st">"ll1"</span>)) <span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">ll</span>, <span class="no">ll1</span>)</pre></body></html></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb225"><html><body><pre class="r"><span class="no">WKT</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/CRS-class.html">CRS</a></span>(<span class="st">"+proj=moll"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/try.html">try</a></span>(<span class="no">xy2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span>(<span class="no">ll</span>, <span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="no">WKT</span>), <span class="kw">legacy</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">verbose</span><span class="kw">=</span><span class="fl">TRUE</span>))</pre></body></html></div>
<pre><code>## proj=pipeline step proj=unitconvert xy_in=deg xy_out=rad step proj=moll
## lon_0=0 x_0=0 y_0=0 ellps=WGS84</code></pre>
<div class="sourceCode" id="cb227"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/try.html">try</a></span>(<span class="no">ll2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span>(<span class="no">xy1</span>, <span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span>(<span class="no">WKT</span>), <span class="kw">inv</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">legacy</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">verbose</span><span class="kw">=</span><span class="fl">TRUE</span>))</pre></body></html></div>
<pre><code>## proj=pipeline step inv proj=moll lon_0=0 x_0=0 y_0=0 ellps=WGS84 step
## proj=unitconvert xy_in=rad xy_out=deg</code></pre>
<div class="sourceCode" id="cb229"><html><body><pre class="r"><span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span>(<span class="st">"ll2"</span>)) <span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">ll</span>, <span class="no">ll2</span>)</pre></body></html></div>
<pre><code>## [1] TRUE</code></pre>
<div id="refs" class="references">
<div id="ref-evers+knudsen17">
<p>Evers, Kristian, and Thomas Knudsen. 2017. <em>Transformation Pipelines for Proj.4</em>. <a href="https://www.fig.net/resources/proceedings/fig_proceedings/fig2017/papers/iss6b/ISS6B_evers_knudsen_9156.pdf">https://www.fig.net/resources/proceedings/fig_proceedings/fig2017/papers/iss6b/ISS6B_evers_knudsen_9156.pdf</a>.</p>
</div>
<div id="ref-knudsen+evers17">
<p>Knudsen, Thomas, and Kristian Evers. 2017. <em>Transformation Pipelines for Proj.4</em>. <a href="https://meetingorganizer.copernicus.org/EGU2017/EGU2017-8050.pdf">https://meetingorganizer.copernicus.org/EGU2017/EGU2017-8050.pdf</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Roger Bivand, Tim Keitt, Barry Rowlingson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
